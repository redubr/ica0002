Tue Jan  3 13:51:50 EET 2023
+ hostname
Renes-MacBook-Pro-2.local
+ ansible-playbook infra.yaml --diff

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [init : Update cache for apt] *********************************************
changed: [server3]
changed: [server2]
changed: [server1]

TASK [node_exporter : NodeExporter and nginx installed] ************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libio-pty-perl
  libipc-run-perl libjbig0 libjpeg-turbo8 libjpeg8
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libtiff5 libtime-duration-perl
  libtimedate-perl libwebp6 libxpm4 moreutils nginx-common nginx-core
  prometheus-node-exporter-collectors smartmontools
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libio-pty-perl
  libipc-run-perl libjbig0 libjpeg-turbo8 libjpeg8
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libtiff5 libtime-duration-perl
  libtimedate-perl libwebp6 libxpm4 moreutils nginx nginx-common nginx-core
  prometheus-node-exporter prometheus-node-exporter-collectors smartmontools
0 upgraded, 25 newly installed, 0 to remove and 231 not upgraded.
changed: [server1]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libio-pty-perl
  libipc-run-perl libjbig0 libjpeg-turbo8 libjpeg8
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libtiff5 libtime-duration-perl
  libtimedate-perl libwebp6 libxpm4 moreutils nginx-common nginx-core
  prometheus-node-exporter-collectors smartmontools
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libio-pty-perl
  libipc-run-perl libjbig0 libjpeg-turbo8 libjpeg8
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libtiff5 libtime-duration-perl
  libtimedate-perl libwebp6 libxpm4 moreutils nginx nginx-common nginx-core
  prometheus-node-exporter prometheus-node-exporter-collectors smartmontools
0 upgraded, 25 newly installed, 0 to remove and 231 not upgraded.
changed: [server2]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libio-pty-perl
  libipc-run-perl libjbig0 libjpeg-turbo8 libjpeg8
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libtiff5 libtime-duration-perl
  libtimedate-perl libwebp6 libxpm4 moreutils nginx-common nginx-core
  prometheus-node-exporter-collectors smartmontools
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libio-pty-perl
  libipc-run-perl libjbig0 libjpeg-turbo8 libjpeg8
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libtiff5 libtime-duration-perl
  libtimedate-perl libwebp6 libxpm4 moreutils nginx nginx-common nginx-core
  prometheus-node-exporter prometheus-node-exporter-collectors smartmontools
0 upgraded, 25 newly installed, 0 to remove and 231 not upgraded.
changed: [server3]

TASK [node_exporter : cp conf] *************************************************
--- before: /etc/default/prometheus-node-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp99whxgxk/node-exp.j2
@@ -1,128 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-node-exporter supports the following options:
-#
-#  --collector.diskstats.ignored-devices="^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\d+n\\d+p)\\d+$"
-#                            Regexp of devices to ignore for diskstats.
-#  --collector.filesystem.ignored-mount-points="^/(dev|proc|run|sys|mnt|media|var/lib/docker)($|/)"
-#                            Regexp of mount points to ignore for filesystem
-#                            collector.
-#  --collector.filesystem.ignored-fs-types="^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$"
-#                            Regexp of filesystem types to ignore for
-#                            filesystem collector.
-#  --collector.netdev.ignored-devices="^lo$"
-#                            Regexp of net devices to ignore for netdev
-#                            collector.
-#  --collector.netstat.fields="^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*)|Tcp_(ActiveOpens|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts))$"
-#                            Regexp of fields to return for netstat
-#                            collector.
-#  --collector.ntp.server="127.0.0.1"
-#                            NTP server to use for ntp collector
-#  --collector.ntp.protocol-version=4
-#                            NTP protocol version
-#  --collector.ntp.server-is-local
-#                            Certify that collector.ntp.server address is the
-#                            same local host as this collector.
-#  --collector.ntp.ip-ttl=1  IP TTL to use while sending NTP query
-#  --collector.ntp.max-distance=3.46608s
-#                            Max accumulated distance to the root
-#  --collector.ntp.local-offset-tolerance=1ms
-#                            Offset between local clock and local ntpd time
-#                            to tolerate
-#  --path.procfs="/proc"     procfs mountpoint.
-#  --path.sysfs="/sys"       sysfs mountpoint.
-#  --collector.qdisc.fixtures=""
-#                            test fixtures to use for qdisc collector
-#                            end-to-end testing
-#  --collector.runit.servicedir="/etc/service"
-#                            Path to runit service directory.
-#  --collector.supervisord.url="http://localhost:9001/RPC2"
-#                            XML RPC endpoint.
-#  --collector.systemd.unit-whitelist=".+"
-#                            Regexp of systemd units to whitelist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.unit-blacklist=".+(\\.device|\\.scope|\\.slice|\\.target)"
-#                            Regexp of systemd units to blacklist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.private
-#                            Establish a private, direct connection to
-#                            systemd without dbus.
-#  --collector.textfile.directory="/var/lib/prometheus/node-exporter"
-#                            Directory to read text files with metrics from.
-#  --collector.vmstat.fields="^(oom_kill|pgpg|pswp|pg.*fault).*"
-#                            Regexp of fields to return for vmstat collector.
-#  --collector.wifi.fixtures=""
-#                            test fixtures to use for wifi collector metrics
-#  --collector.arp           Enable the arp collector (default: enabled).
-#  --collector.bcache        Enable the bcache collector (default: enabled).
-#  --collector.bonding       Enable the bonding collector (default: enabled).
-#  --collector.buddyinfo     Enable the buddyinfo collector (default:
-#                            disabled).
-#  --collector.conntrack     Enable the conntrack collector (default:
-#                            enabled).
-#  --collector.cpu           Enable the cpu collector (default: enabled).
-#  --collector.diskstats     Enable the diskstats collector (default:
-#                            enabled).
-#  --collector.drbd          Enable the drbd collector (default: disabled).
-#  --collector.edac          Enable the edac collector (default: enabled).
-#  --collector.entropy       Enable the entropy collector (default: enabled).
-#  --collector.filefd        Enable the filefd collector (default: enabled).
-#  --collector.filesystem    Enable the filesystem collector (default:
-#                            enabled).
-#  --collector.hwmon         Enable the hwmon collector (default: enabled).
-#  --collector.infiniband    Enable the infiniband collector (default:
-#                            enabled).
-#  --collector.interrupts    Enable the interrupts collector (default:
-#                            disabled).
-#  --collector.ipvs          Enable the ipvs collector (default: enabled).
-#  --collector.ksmd          Enable the ksmd collector (default: disabled).
-#  --collector.loadavg       Enable the loadavg collector (default: enabled).
-#  --collector.logind        Enable the logind collector (default: disabled).
-#  --collector.mdadm         Enable the mdadm collector (default: enabled).
-#  --collector.meminfo       Enable the meminfo collector (default: enabled).
-#  --collector.meminfo_numa  Enable the meminfo_numa collector (default:
-#                            disabled).
-#  --collector.mountstats    Enable the mountstats collector (default:
-#                            disabled).
-#  --collector.netdev        Enable the netdev collector (default: enabled).
-#  --collector.netstat       Enable the netstat collector (default: enabled).
-#  --collector.nfs           Enable the nfs collector (default: enabled).
-#  --collector.nfsd          Enable the nfsd collector (default: enabled).
-#  --collector.ntp           Enable the ntp collector (default: disabled).
-#  --collector.qdisc         Enable the qdisc collector (default: disabled).
-#  --collector.runit         Enable the runit collector (default: disabled).
-#  --collector.sockstat      Enable the sockstat collector (default:
-#                            enabled).
-#  --collector.stat          Enable the stat collector (default: enabled).
-#  --collector.supervisord   Enable the supervisord collector (default:
-#                            disabled).
-#  --collector.systemd       Enable the systemd collector (default: enabled).
-#  --collector.tcpstat       Enable the tcpstat collector (default:
-#                            disabled).
-#  --collector.textfile      Enable the textfile collector (default:
-#                            enabled).
-#  --collector.time          Enable the time collector (default: enabled).
-#  --collector.uname         Enable the uname collector (default: enabled).
-#  --collector.vmstat        Enable the vmstat collector (default: enabled).
-#  --collector.wifi          Enable the wifi collector (default: enabled).
-#  --collector.xfs           Enable the xfs collector (default: enabled).
-#  --collector.zfs           Enable the zfs collector (default: enabled).
-#  --collector.timex         Enable the timex collector (default: enabled).
-#  --web.listen-address=":9100"
-#                            Address on which to expose metrics and web
-#                            interface.
-#  --web.telemetry-path="/metrics"
-#                            Path under which to expose metrics.
-#  --log.level="info"        Only log messages with the given severity or
-#                            above. Valid levels: [debug, info, warn, error,
-#                            fatal]
-#  --log.format="logger:stderr"
-#                            Set the log target and format. Example:
-#                            "logger:syslog?appname=bob&local=7" or
-#                            "logger:stdout?json=true"
+ARGS="--web.listen-address=':9100'"
\ No newline at end of file

changed: [server1]
--- before: /etc/default/prometheus-node-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpkp8pf75f/node-exp.j2
@@ -1,128 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-node-exporter supports the following options:
-#
-#  --collector.diskstats.ignored-devices="^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\d+n\\d+p)\\d+$"
-#                            Regexp of devices to ignore for diskstats.
-#  --collector.filesystem.ignored-mount-points="^/(dev|proc|run|sys|mnt|media|var/lib/docker)($|/)"
-#                            Regexp of mount points to ignore for filesystem
-#                            collector.
-#  --collector.filesystem.ignored-fs-types="^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$"
-#                            Regexp of filesystem types to ignore for
-#                            filesystem collector.
-#  --collector.netdev.ignored-devices="^lo$"
-#                            Regexp of net devices to ignore for netdev
-#                            collector.
-#  --collector.netstat.fields="^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*)|Tcp_(ActiveOpens|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts))$"
-#                            Regexp of fields to return for netstat
-#                            collector.
-#  --collector.ntp.server="127.0.0.1"
-#                            NTP server to use for ntp collector
-#  --collector.ntp.protocol-version=4
-#                            NTP protocol version
-#  --collector.ntp.server-is-local
-#                            Certify that collector.ntp.server address is the
-#                            same local host as this collector.
-#  --collector.ntp.ip-ttl=1  IP TTL to use while sending NTP query
-#  --collector.ntp.max-distance=3.46608s
-#                            Max accumulated distance to the root
-#  --collector.ntp.local-offset-tolerance=1ms
-#                            Offset between local clock and local ntpd time
-#                            to tolerate
-#  --path.procfs="/proc"     procfs mountpoint.
-#  --path.sysfs="/sys"       sysfs mountpoint.
-#  --collector.qdisc.fixtures=""
-#                            test fixtures to use for qdisc collector
-#                            end-to-end testing
-#  --collector.runit.servicedir="/etc/service"
-#                            Path to runit service directory.
-#  --collector.supervisord.url="http://localhost:9001/RPC2"
-#                            XML RPC endpoint.
-#  --collector.systemd.unit-whitelist=".+"
-#                            Regexp of systemd units to whitelist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.unit-blacklist=".+(\\.device|\\.scope|\\.slice|\\.target)"
-#                            Regexp of systemd units to blacklist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.private
-#                            Establish a private, direct connection to
-#                            systemd without dbus.
-#  --collector.textfile.directory="/var/lib/prometheus/node-exporter"
-#                            Directory to read text files with metrics from.
-#  --collector.vmstat.fields="^(oom_kill|pgpg|pswp|pg.*fault).*"
-#                            Regexp of fields to return for vmstat collector.
-#  --collector.wifi.fixtures=""
-#                            test fixtures to use for wifi collector metrics
-#  --collector.arp           Enable the arp collector (default: enabled).
-#  --collector.bcache        Enable the bcache collector (default: enabled).
-#  --collector.bonding       Enable the bonding collector (default: enabled).
-#  --collector.buddyinfo     Enable the buddyinfo collector (default:
-#                            disabled).
-#  --collector.conntrack     Enable the conntrack collector (default:
-#                            enabled).
-#  --collector.cpu           Enable the cpu collector (default: enabled).
-#  --collector.diskstats     Enable the diskstats collector (default:
-#                            enabled).
-#  --collector.drbd          Enable the drbd collector (default: disabled).
-#  --collector.edac          Enable the edac collector (default: enabled).
-#  --collector.entropy       Enable the entropy collector (default: enabled).
-#  --collector.filefd        Enable the filefd collector (default: enabled).
-#  --collector.filesystem    Enable the filesystem collector (default:
-#                            enabled).
-#  --collector.hwmon         Enable the hwmon collector (default: enabled).
-#  --collector.infiniband    Enable the infiniband collector (default:
-#                            enabled).
-#  --collector.interrupts    Enable the interrupts collector (default:
-#                            disabled).
-#  --collector.ipvs          Enable the ipvs collector (default: enabled).
-#  --collector.ksmd          Enable the ksmd collector (default: disabled).
-#  --collector.loadavg       Enable the loadavg collector (default: enabled).
-#  --collector.logind        Enable the logind collector (default: disabled).
-#  --collector.mdadm         Enable the mdadm collector (default: enabled).
-#  --collector.meminfo       Enable the meminfo collector (default: enabled).
-#  --collector.meminfo_numa  Enable the meminfo_numa collector (default:
-#                            disabled).
-#  --collector.mountstats    Enable the mountstats collector (default:
-#                            disabled).
-#  --collector.netdev        Enable the netdev collector (default: enabled).
-#  --collector.netstat       Enable the netstat collector (default: enabled).
-#  --collector.nfs           Enable the nfs collector (default: enabled).
-#  --collector.nfsd          Enable the nfsd collector (default: enabled).
-#  --collector.ntp           Enable the ntp collector (default: disabled).
-#  --collector.qdisc         Enable the qdisc collector (default: disabled).
-#  --collector.runit         Enable the runit collector (default: disabled).
-#  --collector.sockstat      Enable the sockstat collector (default:
-#                            enabled).
-#  --collector.stat          Enable the stat collector (default: enabled).
-#  --collector.supervisord   Enable the supervisord collector (default:
-#                            disabled).
-#  --collector.systemd       Enable the systemd collector (default: enabled).
-#  --collector.tcpstat       Enable the tcpstat collector (default:
-#                            disabled).
-#  --collector.textfile      Enable the textfile collector (default:
-#                            enabled).
-#  --collector.time          Enable the time collector (default: enabled).
-#  --collector.uname         Enable the uname collector (default: enabled).
-#  --collector.vmstat        Enable the vmstat collector (default: enabled).
-#  --collector.wifi          Enable the wifi collector (default: enabled).
-#  --collector.xfs           Enable the xfs collector (default: enabled).
-#  --collector.zfs           Enable the zfs collector (default: enabled).
-#  --collector.timex         Enable the timex collector (default: enabled).
-#  --web.listen-address=":9100"
-#                            Address on which to expose metrics and web
-#                            interface.
-#  --web.telemetry-path="/metrics"
-#                            Path under which to expose metrics.
-#  --log.level="info"        Only log messages with the given severity or
-#                            above. Valid levels: [debug, info, warn, error,
-#                            fatal]
-#  --log.format="logger:stderr"
-#                            Set the log target and format. Example:
-#                            "logger:syslog?appname=bob&local=7" or
-#                            "logger:stdout?json=true"
+ARGS="--web.listen-address=':9100'"
\ No newline at end of file

changed: [server3]
--- before: /etc/default/prometheus-node-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmphx5acx2_/node-exp.j2
@@ -1,128 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-node-exporter supports the following options:
-#
-#  --collector.diskstats.ignored-devices="^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\d+n\\d+p)\\d+$"
-#                            Regexp of devices to ignore for diskstats.
-#  --collector.filesystem.ignored-mount-points="^/(dev|proc|run|sys|mnt|media|var/lib/docker)($|/)"
-#                            Regexp of mount points to ignore for filesystem
-#                            collector.
-#  --collector.filesystem.ignored-fs-types="^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$"
-#                            Regexp of filesystem types to ignore for
-#                            filesystem collector.
-#  --collector.netdev.ignored-devices="^lo$"
-#                            Regexp of net devices to ignore for netdev
-#                            collector.
-#  --collector.netstat.fields="^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*)|Tcp_(ActiveOpens|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts))$"
-#                            Regexp of fields to return for netstat
-#                            collector.
-#  --collector.ntp.server="127.0.0.1"
-#                            NTP server to use for ntp collector
-#  --collector.ntp.protocol-version=4
-#                            NTP protocol version
-#  --collector.ntp.server-is-local
-#                            Certify that collector.ntp.server address is the
-#                            same local host as this collector.
-#  --collector.ntp.ip-ttl=1  IP TTL to use while sending NTP query
-#  --collector.ntp.max-distance=3.46608s
-#                            Max accumulated distance to the root
-#  --collector.ntp.local-offset-tolerance=1ms
-#                            Offset between local clock and local ntpd time
-#                            to tolerate
-#  --path.procfs="/proc"     procfs mountpoint.
-#  --path.sysfs="/sys"       sysfs mountpoint.
-#  --collector.qdisc.fixtures=""
-#                            test fixtures to use for qdisc collector
-#                            end-to-end testing
-#  --collector.runit.servicedir="/etc/service"
-#                            Path to runit service directory.
-#  --collector.supervisord.url="http://localhost:9001/RPC2"
-#                            XML RPC endpoint.
-#  --collector.systemd.unit-whitelist=".+"
-#                            Regexp of systemd units to whitelist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.unit-blacklist=".+(\\.device|\\.scope|\\.slice|\\.target)"
-#                            Regexp of systemd units to blacklist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.private
-#                            Establish a private, direct connection to
-#                            systemd without dbus.
-#  --collector.textfile.directory="/var/lib/prometheus/node-exporter"
-#                            Directory to read text files with metrics from.
-#  --collector.vmstat.fields="^(oom_kill|pgpg|pswp|pg.*fault).*"
-#                            Regexp of fields to return for vmstat collector.
-#  --collector.wifi.fixtures=""
-#                            test fixtures to use for wifi collector metrics
-#  --collector.arp           Enable the arp collector (default: enabled).
-#  --collector.bcache        Enable the bcache collector (default: enabled).
-#  --collector.bonding       Enable the bonding collector (default: enabled).
-#  --collector.buddyinfo     Enable the buddyinfo collector (default:
-#                            disabled).
-#  --collector.conntrack     Enable the conntrack collector (default:
-#                            enabled).
-#  --collector.cpu           Enable the cpu collector (default: enabled).
-#  --collector.diskstats     Enable the diskstats collector (default:
-#                            enabled).
-#  --collector.drbd          Enable the drbd collector (default: disabled).
-#  --collector.edac          Enable the edac collector (default: enabled).
-#  --collector.entropy       Enable the entropy collector (default: enabled).
-#  --collector.filefd        Enable the filefd collector (default: enabled).
-#  --collector.filesystem    Enable the filesystem collector (default:
-#                            enabled).
-#  --collector.hwmon         Enable the hwmon collector (default: enabled).
-#  --collector.infiniband    Enable the infiniband collector (default:
-#                            enabled).
-#  --collector.interrupts    Enable the interrupts collector (default:
-#                            disabled).
-#  --collector.ipvs          Enable the ipvs collector (default: enabled).
-#  --collector.ksmd          Enable the ksmd collector (default: disabled).
-#  --collector.loadavg       Enable the loadavg collector (default: enabled).
-#  --collector.logind        Enable the logind collector (default: disabled).
-#  --collector.mdadm         Enable the mdadm collector (default: enabled).
-#  --collector.meminfo       Enable the meminfo collector (default: enabled).
-#  --collector.meminfo_numa  Enable the meminfo_numa collector (default:
-#                            disabled).
-#  --collector.mountstats    Enable the mountstats collector (default:
-#                            disabled).
-#  --collector.netdev        Enable the netdev collector (default: enabled).
-#  --collector.netstat       Enable the netstat collector (default: enabled).
-#  --collector.nfs           Enable the nfs collector (default: enabled).
-#  --collector.nfsd          Enable the nfsd collector (default: enabled).
-#  --collector.ntp           Enable the ntp collector (default: disabled).
-#  --collector.qdisc         Enable the qdisc collector (default: disabled).
-#  --collector.runit         Enable the runit collector (default: disabled).
-#  --collector.sockstat      Enable the sockstat collector (default:
-#                            enabled).
-#  --collector.stat          Enable the stat collector (default: enabled).
-#  --collector.supervisord   Enable the supervisord collector (default:
-#                            disabled).
-#  --collector.systemd       Enable the systemd collector (default: enabled).
-#  --collector.tcpstat       Enable the tcpstat collector (default:
-#                            disabled).
-#  --collector.textfile      Enable the textfile collector (default:
-#                            enabled).
-#  --collector.time          Enable the time collector (default: enabled).
-#  --collector.uname         Enable the uname collector (default: enabled).
-#  --collector.vmstat        Enable the vmstat collector (default: enabled).
-#  --collector.wifi          Enable the wifi collector (default: enabled).
-#  --collector.xfs           Enable the xfs collector (default: enabled).
-#  --collector.zfs           Enable the zfs collector (default: enabled).
-#  --collector.timex         Enable the timex collector (default: enabled).
-#  --web.listen-address=":9100"
-#                            Address on which to expose metrics and web
-#                            interface.
-#  --web.telemetry-path="/metrics"
-#                            Path under which to expose metrics.
-#  --log.level="info"        Only log messages with the given severity or
-#                            above. Valid levels: [debug, info, warn, error,
-#                            fatal]
-#  --log.format="logger:stderr"
-#                            Set the log target and format. Example:
-#                            "logger:syslog?appname=bob&local=7" or
-#                            "logger:stdout?json=true"
+ARGS="--web.listen-address=':9100'"
\ No newline at end of file

changed: [server2]

TASK [node_exporter : Enable node exporter] ************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [users : Add user roman] **************************************************
changed: [server1]
changed: [server2]
changed: [server3]

TASK [users : Add user juri] ***************************************************
changed: [server3]
changed: [server2]
changed: [server1]

TASK [users : Ssh key for roman] ***********************************************
changed: [server1]
changed: [server3]
changed: [server2]

TASK [users : Ssh key for juri] ************************************************
changed: [server1]
changed: [server3]
changed: [server2]

TASK [rsyslog : ensure ryslog is installed] ************************************
Suggested packages:
  rsyslog-mysql | rsyslog-pgsql rsyslog-mongodb rsyslog-doc rsyslog-openssl
  | rsyslog-gnutls rsyslog-gssapi rsyslog-relp
The following packages will be upgraded:
  rsyslog
1 upgraded, 0 newly installed, 0 to remove and 230 not upgraded.
changed: [server2]
Suggested packages:
  rsyslog-mysql | rsyslog-pgsql rsyslog-mongodb rsyslog-doc rsyslog-openssl
  | rsyslog-gnutls rsyslog-gssapi rsyslog-relp
The following packages will be upgraded:
  rsyslog
1 upgraded, 0 newly installed, 0 to remove and 230 not upgraded.
changed: [server3]
Suggested packages:
  rsyslog-mysql | rsyslog-pgsql rsyslog-mongodb rsyslog-doc rsyslog-openssl
  | rsyslog-gnutls rsyslog-gssapi rsyslog-relp
The following packages will be upgraded:
  rsyslog
1 upgraded, 0 newly installed, 0 to remove and 230 not upgraded.
changed: [server1]

TASK [rsyslog : copy configuration] ********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpdbguyvwg/telegraf-syslog.conf.j2
@@ -0,0 +1,3 @@
+action(type="omfwd" Protocol="udp" Target="server1.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+action(type="omfwd" Protocol="udp" Target="server2.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+action(type="omfwd" Protocol="udp" Target="server3.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
\ No newline at end of file

changed: [server3]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmplb2fucpj/telegraf-syslog.conf.j2
@@ -0,0 +1,3 @@
+action(type="omfwd" Protocol="udp" Target="server1.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+action(type="omfwd" Protocol="udp" Target="server2.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+action(type="omfwd" Protocol="udp" Target="server3.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
\ No newline at end of file

changed: [server2]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp25u19r07/telegraf-syslog.conf.j2
@@ -0,0 +1,3 @@
+action(type="omfwd" Protocol="udp" Target="server1.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+action(type="omfwd" Protocol="udp" Target="server2.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
+action(type="omfwd" Protocol="udp" Target="server3.infra.rd" Port="6514" Template="RSYSLOG_SyslogProtocol23Format")
\ No newline at end of file

changed: [server1]

TASK [rsyslog : enable rsyslog] ************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [backup : backup user] ****************************************************
changed: [server3]
changed: [server2]
changed: [server1]

TASK [backup : copy known hosts] ***********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp_t4ct5fq/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.infra.rd ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [server1]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpintne1xl/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.infra.rd ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [server3]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp3j0ljq7e/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.infra.rd ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [server2]

TASK [backup : restore directory] **********************************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "mode": "0755",
-    "owner": 0,
+    "mode": "0774",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server3]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "mode": "0755",
-    "owner": 0,
+    "mode": "0774",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server2]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "mode": "0755",
-    "owner": 0,
+    "mode": "0774",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server1]

TASK [backup : ensure duplicity is installed] **********************************
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [server3]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [server1]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 230 not upgraded.
changed: [server2]

TASK [docker : ensure docker is installed] *************************************
The following additional packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base libidn11 pigz
  python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base docker.io libidn11 pigz
  python3-docker python3-websocket runc ubuntu-fan
0 upgraded, 11 newly installed, 0 to remove and 230 not upgraded.
changed: [server3]
The following additional packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base libidn11 pigz
  python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base docker.io libidn11 pigz
  python3-docker python3-websocket runc ubuntu-fan
0 upgraded, 11 newly installed, 0 to remove and 230 not upgraded.
changed: [server2]
The following additional packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base libidn11 pigz
  python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base docker.io libidn11 pigz
  python3-docker python3-websocket runc ubuntu-fan
0 upgraded, 11 newly installed, 0 to remove and 230 not upgraded.
changed: [server1]

TASK [docker : docker enabled] *************************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [nginx : Ensure Nginx is installed] ***************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [nginx : start nginx] *****************************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [nginx : Copy template to server] *****************************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpfsip_erd/default.j2
@@ -1,91 +1,22 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+    
+		location /prometheus {
+    		proxy_pass http://localhost:9090;
+    }
+	
+	    	location /grafana {
+    	        proxy_set_header Host $http_host;
+        		proxy_pass http://localhost:3000;
+        }
+    
 }
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+server {
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}
\ No newline at end of file

changed: [server3]
--- before: /etc/nginx/sites-enabled/default
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpkw96kk7h/default.j2
@@ -1,91 +1,18 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+    	location / {
+		proxy_pass http://localhost:5000;
 	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+	
+	
+	
 }
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+server {
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}
\ No newline at end of file

changed: [server2]
--- before: /etc/nginx/sites-enabled/default
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpqmi0604l/default.j2
@@ -1,91 +1,18 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+    	location / {
+		proxy_pass http://localhost:5000;
 	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+	
+	
+	
 }
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+server {
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}
\ No newline at end of file

changed: [server1]

RUNNING HANDLER [node_exporter : restart] **************************************
changed: [server3]
changed: [server2]
changed: [server1]

RUNNING HANDLER [rsyslog : restarted] ******************************************
changed: [server3]
changed: [server1]
changed: [server2]

RUNNING HANDLER [nginx : Restart nginx] ****************************************
changed: [server3]
changed: [server2]
changed: [server1]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [mysql : Ensure mysql server is installed] ********************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
  python-pymysql-doc
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0 python3-pymysql
0 upgraded, 25 newly installed, 0 to remove and 230 not upgraded.
changed: [server2]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
  python-pymysql-doc
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0 python3-pymysql
0 upgraded, 25 newly installed, 0 to remove and 230 not upgraded.
changed: [server1]

TASK [mysql : Configure] *******************************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpni0domxu/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 337
\ No newline at end of file

changed: [server1]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpk49hh93l/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 447
\ No newline at end of file

changed: [server2]

TASK [mysql : MySql started and enabled] ***************************************
ok: [server1]
ok: [server2]

TASK [mysql : Add MySQL Database] **********************************************
changed: [server2]
changed: [server1]

TASK [mysql : Add MySQL user] **************************************************
changed: [server1]
changed: [server2]

TASK [mysql : MySql user for exporter] *****************************************
changed: [server1]
changed: [server2]

TASK [mysql : MySql user for replication] **************************************
changed: [server2]
changed: [server1]

TASK [mysql : replica server read_only] ****************************************
changed: [server1]
changed: [server2]

TASK [mysql_backup : mysql directory] ******************************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0774",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server1]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0774",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server2]

TASK [mysql_backup : MySql user for backup] ************************************
changed: [server2]
changed: [server1]

TASK [mysql_backup : cp conf] **************************************************
changed: [server1]
changed: [server2]

TASK [mysql_backup : Cronjob cp] ***********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp_05ae7qm/mysql-backup.j2
@@ -0,0 +1,3 @@
+0 */3 * * * backup mysqldump agama > /home/backup/mysql/agama.sql
+30 */3 * * *  backup duplicity --no-encryption full /home/backup/mysql/ rsync://redubr@backup.infra.rd/mysql
+45 */1 * * *  backup duplicity --no-encryption incremental /home/backup/mysql/ rsync://redubr@backup.infra.rd/mysql

changed: [server1]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpldtp__fp/mysql-backup.j2
@@ -0,0 +1 @@
+

changed: [server2]

RUNNING HANDLER [mysql : Restart mysql] ****************************************
changed: [server2]
changed: [server1]

RUNNING HANDLER [mysql : reset source] *****************************************
skipping: [server1] => (item=stopreplica) 
skipping: [server1] => (item=resetprimary) 
ok: [server2] => (item=stopreplica)
changed: [server2] => (item=resetprimary)

RUNNING HANDLER [mysql : reset replica] ****************************************
skipping: [server2] => (item=None) 
skipping: [server2] => (item=None) 
skipping: [server2] => (item=None) 
skipping: [server2] => (item=None) 
skipping: [server2]
ok: [server1] => (item=None)
changed: [server1] => (item=None)
changed: [server1] => (item=None)
changed: [server1] => (item=None)
changed: [server1]

PLAY [Web server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [agama : directory for agama] *********************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server2]

TASK [agama : agama dockerfile] ************************************************
changed: [server2]
changed: [server1]

TASK [agama : Get agama] *******************************************************
changed: [server1]
changed: [server2]

TASK [agama : agama docker image build] ****************************************
changed: [server2]
changed: [server1]

TASK [agama : start agama container] *******************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [server2]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [server1]

PLAY [DNS Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [Gather facts from ALL hosts (regardless of limit or tags)] ***************
skipping: [server3] => (item=server1) 
skipping: [server3] => (item=server2) 
skipping: [server3] => (item=server3) 
skipping: [server1] => (item=server1) 
skipping: [server1] => (item=server2) 
skipping: [server1] => (item=server3) 
skipping: [server2] => (item=server1) 
skipping: [server2] => (item=server2) 
skipping: [server2] => (item=server3) 

TASK [bind : install bind9] ****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 4 newly installed, 0 to remove and 228 not upgraded.
changed: [server3]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 4 newly installed, 0 to remove and 228 not upgraded.
changed: [server1]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 4 newly installed, 0 to remove and 228 not upgraded.
changed: [server2]

TASK [bind : Copy config] ******************************************************
changed: [server3]
changed: [server1]
changed: [server2]

TASK [bind : Copy master zone db] **********************************************
skipping: [server1]
skipping: [server2]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpn5ud8o00/db.dok.j2
@@ -0,0 +1,16 @@
+$TTL	604800
+infra.rd.	IN	SOA	server3.infra.rd. redubr.infra.rd. (
+	              2     ; Serial
+			 604800		; Refresh
+			  86400		; Retry
+			2419200		; Expire
+			 604800 )	; Negative Cache TTL
+;
+infra.rd.	IN	NS	server3
+infra.rd.	IN	NS	server1
+infra.rd.	IN	NS	server2
+
+server1    IN  A   192.168.43.81
+server2    IN  A   192.168.43.191
+server3    IN  A   192.168.43.79
+backup    IN A 192.168.42.132

changed: [server3]

TASK [bind : Copy reverse zone db] *********************************************
skipping: [server1]
skipping: [server2]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp2pd4a8xd/db.dok.reverse.j2
@@ -0,0 +1,16 @@
+$TTL	604800
+43.168.192.in-addr.arpa.	IN	SOA	server3.infra.rd. redubr.infra.rd. (
+	              5     ; Serial
+			 604800		; Refresh
+			  86400		; Retry
+			2419200		; Expire
+			 604800 )	; Negative Cache TTL
+;
+
+43.168.192.in-addr.arpa.	IN	NS	server3.infra.rd.
+43.168.192.in-addr.arpa.	IN	NS	server1.infra.rd.
+43.168.192.in-addr.arpa.	IN	NS	server2.infra.rd.
+
+81  IN  PTR  server1.infra.rd.
+191  IN  PTR  server2.infra.rd.
+79  IN  PTR  server3.infra.rd.

changed: [server3]

TASK [bind : CP local] *********************************************************
--- before: /etc/bind/named.conf.local
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpbhmqtpkg/named.conf.local.j2
@@ -1,8 +1,16 @@
-//
-// Do any local configuration here
-//
+zone "infra.rd" {
+    type master;
+  allow-transfer { key transfer.key; };
+  allow-update { key update.key; };
+  
+  file "db.infra.rd";
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+};
 
+zone "43.168.192.in-addr.arpa" {
+  type master;
+  allow-transfer { 127.0.0.0/8; key transfer.key; };
+  allow-update { key update.key; };
+  
+  file "db.infra.rd.reverse";
+};
\ No newline at end of file

changed: [server3]
--- before: /etc/bind/named.conf.local
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpts11wsqx/named.conf.local.j2
@@ -1,8 +1,17 @@
-//
-// Do any local configuration here
-//
+zone "infra.rd" {
+    type slave;
+  masters { 192.168.43.79 key transfer.key; };
+  
+  file "db.infra.rd";
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+};
+server  192.168.43.79 {
+        keys {transfer.key;};
+};
 
+zone "43.168.192.in-addr.arpa" {
+  type slave;
+  masters { 192.168.43.79 key transfer.key; };
+  
+  file "db.infra.rd.reverse";
+};
\ No newline at end of file

changed: [server1]
--- before: /etc/bind/named.conf.local
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpzh_oao4c/named.conf.local.j2
@@ -1,8 +1,17 @@
-//
-// Do any local configuration here
-//
+zone "infra.rd" {
+    type slave;
+  masters { 192.168.43.79 key transfer.key; };
+  
+  file "db.infra.rd";
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+};
+server  192.168.43.79 {
+        keys {transfer.key;};
+};
 
+zone "43.168.192.in-addr.arpa" {
+  type slave;
+  masters { 192.168.43.79 key transfer.key; };
+  
+  file "db.infra.rd.reverse";
+};
\ No newline at end of file

changed: [server2]

TASK [bind : start bind9] ******************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [bind : execute handlers] *************************************************

RUNNING HANDLER [bind : restart bind9] *****************************************
changed: [server2]
changed: [server1]
changed: [server3]

RUNNING HANDLER [bind : reload rndc] *******************************************
changed: [server3]
changed: [server1]
changed: [server2]

TASK [bind : wait] *************************************************************
Pausing for 15 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [server3]

TASK [bind : Add A records] ****************************************************
changed: [server3] => (item={'key': 'backup.infra.rd', 'value': '192.168.42.132'})

TASK [bind : Add CNAME records] ************************************************
changed: [server3] => (item={'key': 'grafana', 'value': 'server3'})
changed: [server3] => (item={'key': 'influxdb', 'value': 'server3'})
changed: [server3] => (item={'key': 'lb1', 'value': 'server1'})
changed: [server3] => (item={'key': 'lb2', 'value': 'server2'})
changed: [server3] => (item={'key': 'mysql1', 'value': 'server1'})
changed: [server3] => (item={'key': 'mysql2', 'value': 'server2'})
changed: [server3] => (item={'key': 'ns1', 'value': 'server1'})
changed: [server3] => (item={'key': 'ns2', 'value': 'server3'})
changed: [server3] => (item={'key': 'prometheus', 'value': 'server3'})
changed: [server3] => (item={'key': 'web1', 'value': 'server1'})
changed: [server3] => (item={'key': 'web2', 'value': 'server2'})

TASK [bind_exporter : Bind exporter installed] *********************************
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server3]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server1]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server2]

TASK [bind_exporter : Copy args] ***********************************************
--- before: /etc/default/prometheus-bind-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpkgkdvhn9/bind-exporter.j2
@@ -1,24 +1 @@
-# Set the command-line arguments to pass to the server.
-ARGS=''
-
-# Usage of prometheus-bind-exporter:
-#  -bind.pid-file string
-#    	Path to Bind's pid file to export process information.
-#  -bind.stats-groups value
-#    	Comma-separated list of statistics to collect. Available: [server, view, tasks] (default "server,view")
-#  -bind.stats-url string
-#    	HTTP XML API address of an Bind server. (default "http://localhost:8053/")
-#  -bind.stats-version string
-#    	BIND statistics version. Can be detected automatically. Available: [xml.v2, xml.v3, auto] (default "auto")
-#  -bind.timeout duration
-#    	Timeout for trying to get stats from Bind. (default 10s)
-#  -log.format value
-#    	Set the log target and format. Example: "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true" (default "logger:stderr")
-#  -log.level value
-#    	Only log messages with the given severity or above. Valid levels: [debug, info, warn, error, fatal] (default "info")
-#  -version
-#    	Print version information.
-#  -web.listen-address string
-#    	Address to listen on for web interface and telemetry. (default ":9119")
-#  -web.telemetry-path string
-#    	Path under which to expose metrics. (default "/metrics")
+ARGS="-web.listen-address ':9119' -bind.stats-url 'http://localhost:8053/'"
\ No newline at end of file

changed: [server1]
--- before: /etc/default/prometheus-bind-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpjlboxmj_/bind-exporter.j2
@@ -1,24 +1 @@
-# Set the command-line arguments to pass to the server.
-ARGS=''
-
-# Usage of prometheus-bind-exporter:
-#  -bind.pid-file string
-#    	Path to Bind's pid file to export process information.
-#  -bind.stats-groups value
-#    	Comma-separated list of statistics to collect. Available: [server, view, tasks] (default "server,view")
-#  -bind.stats-url string
-#    	HTTP XML API address of an Bind server. (default "http://localhost:8053/")
-#  -bind.stats-version string
-#    	BIND statistics version. Can be detected automatically. Available: [xml.v2, xml.v3, auto] (default "auto")
-#  -bind.timeout duration
-#    	Timeout for trying to get stats from Bind. (default 10s)
-#  -log.format value
-#    	Set the log target and format. Example: "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true" (default "logger:stderr")
-#  -log.level value
-#    	Only log messages with the given severity or above. Valid levels: [debug, info, warn, error, fatal] (default "info")
-#  -version
-#    	Print version information.
-#  -web.listen-address string
-#    	Address to listen on for web interface and telemetry. (default ":9119")
-#  -web.telemetry-path string
-#    	Path under which to expose metrics. (default "/metrics")
+ARGS="-web.listen-address ':9119' -bind.stats-url 'http://localhost:8053/'"
\ No newline at end of file

changed: [server2]
--- before: /etc/default/prometheus-bind-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpiupt2vh8/bind-exporter.j2
@@ -1,24 +1 @@
-# Set the command-line arguments to pass to the server.
-ARGS=''
-
-# Usage of prometheus-bind-exporter:
-#  -bind.pid-file string
-#    	Path to Bind's pid file to export process information.
-#  -bind.stats-groups value
-#    	Comma-separated list of statistics to collect. Available: [server, view, tasks] (default "server,view")
-#  -bind.stats-url string
-#    	HTTP XML API address of an Bind server. (default "http://localhost:8053/")
-#  -bind.stats-version string
-#    	BIND statistics version. Can be detected automatically. Available: [xml.v2, xml.v3, auto] (default "auto")
-#  -bind.timeout duration
-#    	Timeout for trying to get stats from Bind. (default 10s)
-#  -log.format value
-#    	Set the log target and format. Example: "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true" (default "logger:stderr")
-#  -log.level value
-#    	Only log messages with the given severity or above. Valid levels: [debug, info, warn, error, fatal] (default "info")
-#  -version
-#    	Print version information.
-#  -web.listen-address string
-#    	Address to listen on for web interface and telemetry. (default ":9119")
-#  -web.telemetry-path string
-#    	Path under which to expose metrics. (default "/metrics")
+ARGS="-web.listen-address ':9119' -bind.stats-url 'http://localhost:8053/'"
\ No newline at end of file

changed: [server3]

TASK [bind_exporter : Enable bind exporter] ************************************
ok: [server2]
ok: [server3]
ok: [server1]

RUNNING HANDLER [bind_exporter : restart] **************************************
changed: [server3]
changed: [server1]
changed: [server2]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [prometheus : Prometheus installed] ***************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc
Suggested packages:
  npm
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc prometheus
0 upgraded, 19 newly installed, 0 to remove and 228 not upgraded.
changed: [server3]

TASK [prometheus : CP ARGS] ****************************************************
--- before: /etc/default/prometheus
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpc_zb_x0y/prometheus.j2
@@ -1,57 +1 @@
-# Set the command-line arguments to pass to the server.
-ARGS=""
-
-# Prometheus supports the following options:
-#  --config.file="/etc/prometheus/prometheus.yml"
-#                             Prometheus configuration file path.
-#  --web.listen-address="0.0.0.0:9090"
-#                             Address to listen on for UI, API, and telemetry.
-#  --web.read-timeout=5m      Maximum duration before timing out read of the
-#                             request, and closing idle connections.
-#  --web.max-connections=512  Maximum number of simultaneous connections.
-#  --web.external-url=<URL>   The URL under which Prometheus is externally
-#                             reachable (for example, if Prometheus is served
-#                             via a reverse proxy). Used for generating
-#                             relative and absolute links back to Prometheus
-#                             itself. If the URL has a path portion, it will
-#                             be used to prefix all HTTP endpoints served by
-#                             Prometheus. If omitted, relevant URL components
-#                             will be derived automatically.
-#  --web.route-prefix=<path>  Prefix for the internal routes of web endpoints.
-#                             Defaults to path of --web.external-url.
-#  --web.local-assets="/usr/share/prometheus/web/"
-#                             Path to static asset/templates directory.
-#  --web.user-assets=<path>   Path to static asset directory, available at
-#                             /user.
-#  --web.enable-lifecycle     Enable shutdown and reload via HTTP request.
-#  --web.enable-admin-api     Enables API endpoints for admin control actions.
-#  --web.console.templates="/etc/prometheus/consoles"
-#                             Path to the console template directory,
-#                             available at /consoles.
-#  --web.console.libraries="/etc/prometheus/console_libraries"
-#                             Path to the console library directory.
-#  --storage.tsdb.path="/var/lib/prometheus/metrics2/"
-#                             Base path for metrics storage.
-#  --storage.tsdb.min-block-duration=2h
-#                             Minimum duration of a data block before being
-#                             persisted.
-#  --storage.tsdb.max-block-duration=<duration>
-#                             Maximum duration compacted blocks may span.
-#                             (Defaults to 10% of the retention period)
-#  --storage.tsdb.retention=15d
-#                             How long to retain samples in the storage.
-#  --storage.tsdb.use-lockfile
-#                             Create a lockfile in data directory.
-#  --alertmanager.notification-queue-capacity=10000
-#                             The capacity of the queue for pending alert
-#                             manager notifications.
-#  --alertmanager.timeout=10s
-#                             Timeout for sending alerts to Alertmanager.
-#  --query.lookback-delta=5m  The delta difference allowed for retrieving
-#                             metrics during expression evaluations.
-#  --query.timeout=2m         Maximum time a query may take before being
-#                             aborted.
-#  --query.max-concurrency=20
-#                             Maximum number of queries executed concurrently.
-#  --log.level=info           Only log messages with the given severity or
-#                             above. One of: [debug, info, warn, error]
+ARGS="--web.external-url=http://193.40.156.67:33580/prometheus --web.listen-address=:9090"
\ No newline at end of file

changed: [server3]

TASK [prometheus : Copy conf] **************************************************
--- before: /etc/prometheus/prometheus.yml
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpv6ic6u_h/prometheus.yml.j2
@@ -1,44 +1,71 @@
-# Sample config for Prometheus.
+global:
+  scrape_interval: 15s
+  scrape_timeout: 10s
+  evaluation_interval: 15s
+  external_labels:
+    monitor: example
 
-global:
-  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
-  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
-  # scrape_timeout is set to the global default (10s).
-
-  # Attach these labels to any time series or alerts when communicating with
-  # external systems (federation, remote storage, Alertmanager).
-  external_labels:
-      monitor: 'example'
-
-# Alertmanager configuration
 alerting:
   alertmanagers:
   - static_configs:
-    - targets: ['localhost:9093']
+    - targets:
+      - localhost:9093
+    scheme: http
+    timeout: 10s
+    api_version: v1
 
-# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
-rule_files:
-  # - "first_rules.yml"
-  # - "second_rules.yml"
+scrape_configs:
 
-# A scrape configuration containing exactly one endpoint to scrape:
-# Here it's Prometheus itself.
-scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
-  - job_name: 'prometheus'
+- job_name: linux
+  static_configs:
+    - targets:
+      - server1.infra.rd:9100
+      - server2.infra.rd:9100
+      - server3.infra.rd:9100
 
-    # Override the global default and scrape targets from this job every 5 seconds.
-    scrape_interval: 5s
-    scrape_timeout: 5s
+- job_name: bind9
+  static_configs:
+    - targets:
+      - server3.infra.rd:9119
+      - server1.infra.rd:9119
+      - server2.infra.rd:9119
 
-    # metrics_path defaults to '/metrics'
-    # scheme defaults to 'http'.
+- job_name: nginx
+  static_configs:
+    - targets:
+      - server1.infra.rd:9113
+      - server2.infra.rd:9113
+      - server3.infra.rd:9113
 
-    static_configs:
-      - targets: ['localhost:9090']
+- job_name: mysql
+  static_configs:
+    - targets:
+      - server1.infra.rd:9104
+      - server2.infra.rd:9104
 
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
-    static_configs:
-      - targets: ['localhost:9100']
+- job_name: haproxy
+  static_configs:
+    - targets:
+      - server1.infra.rd:9101
+      - server2.infra.rd:9101
+
+- job_name: keepalived
+  static_configs:
+    - targets:
+      - server1.infra.rd:9165
+      - server2.infra.rd:9165
+
+- job_name: influxdb
+  static_configs:
+    - targets:
+      - server3.infra.rd:9424
+
+- job_name: prometheus
+  honor_timestamps: true
+  scrape_interval: 5s
+  scrape_timeout: 5s
+  metrics_path: /prometheus/metrics
+  scheme: http
+  static_configs:
+  - targets:
+    - localhost:9090
\ No newline at end of file

changed: [server3]

TASK [prometheus : Start prometheus] *******************************************
ok: [server3]

RUNNING HANDLER [prometheus : restart] *****************************************
changed: [server3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [grafana : Create the grafana user] ***************************************
changed: [server3]

TASK [grafana : folder with correct permissions datasources] *******************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/docker/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server3]

TASK [grafana : folder with correct permissions dashboards] ********************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/docker/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server3]

TASK [grafana : Config] ********************************************************
changed: [server3]

TASK [grafana : Datasources] ***************************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp94wgah7s/default.yaml.j2
@@ -0,0 +1,24 @@
+apiVersion: 1
+
+datasources:
+  - name: Prometheus
+    type: prometheus
+    url: http://192.168.43.79:9090/prometheus
+    basicAuth: false
+    editable: true
+
+  - name: influx-latency
+    type: influxdb
+    url: http://192.168.43.79:8086
+    access: proxy
+    basicAuth: false
+    database: latency
+
+  - name: influx-telegraf
+    type: influxdb
+    url: http://192.168.43.79:8086
+    access: proxy
+    basicAuth: false
+    database: telegraf
+    jsonData:
+          httpMode: POST
\ No newline at end of file

changed: [server3]

TASK [grafana : dashboards yaml] ***********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp2dl6pd8x/sample.yaml.j2
@@ -0,0 +1,10 @@
+apiVersion: 1
+
+providers:
+- name: 'main'
+  orgId: 1
+  folder: ''
+  folderUid: ''
+  type: file
+  options:
+    path: /etc/grafana/provisioning/dashboards
\ No newline at end of file

changed: [server3]

TASK [grafana : copy dashboards] ***********************************************
--- before
+++ after: /Users/admin/CLionProjects/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,757 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "blue",
+                  "index": 1,
+                  "text": "READ_WRITE"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "READ-ONLY"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_global_variables_read_only\", instance=\"server1.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1:"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_global_variables_read_only\", instance=\"server2.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 2:"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "id": 12,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_variables_read_only",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Read Only",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "blue",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_global_status_queries\", instance=\"server2.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 2:"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_global_status_queries\", instance=\"server1.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1:"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "id": 4,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_status_queries",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Queries",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_up\", instance=\"server1.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1:"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_up\", instance=\"server2.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 2:"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 8
+      },
+      "id": 2,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [
+            {
+              "options": {
+                "1": {
+                  "color": "green",
+                  "index": 0
+                },
+                "2": {
+                  "color": "red",
+                  "index": 1
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 8
+      },
+      "id": 8,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_variables_read_only",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Read-Only status history",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "blue",
+                "value": null
+              },
+              {
+                "color": "blue",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_global_variables_server_id\", instance=\"server1.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1 ID:"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"mysql_global_variables_server_id\", instance=\"server2.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 2 ID:"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 16
+      },
+      "id": 6,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_variables_server_id",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Server ID's",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 4,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [
+            {
+              "options": {
+                "1": {
+                  "color": "green",
+                  "index": 0
+                },
+                "2": {
+                  "color": "red",
+                  "index": 1
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 16
+      },
+      "id": 9,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_sql_running",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Slave SQL Running",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 5,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [
+            {
+              "options": {
+                "1": {
+                  "color": "green",
+                  "index": 0
+                },
+                "2": {
+                  "color": "red",
+                  "index": 1
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 24
+      },
+      "id": 10,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_io_running",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Slave IO Running",
+      "type": "timeseries"
+    }
+  ],
+  "schemaVersion": 37,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "MySQL",
+  "uid": "EsTyX5tVk",
+  "version": 1,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/mysql.json)
--- before
+++ after: /Users/admin/CLionProjects/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,2181 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "collapsed": true,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "id": 31,
+      "panels": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "palette-classic"
+              },
+              "custom": {
+                "axisCenteredZero": false,
+                "axisColorMode": "text",
+                "axisLabel": "",
+                "axisPlacement": "auto",
+                "barAlignment": 0,
+                "drawStyle": "line",
+                "fillOpacity": 0,
+                "gradientMode": "none",
+                "hideFrom": {
+                  "legend": false,
+                  "tooltip": false,
+                  "viz": false
+                },
+                "lineInterpolation": "linear",
+                "lineWidth": 4,
+                "pointSize": 5,
+                "scaleDistribution": {
+                  "type": "linear"
+                },
+                "showPoints": "auto",
+                "spanNulls": false,
+                "stacking": {
+                  "group": "A",
+                  "mode": "none"
+                },
+                "thresholdsStyle": {
+                  "mode": "off"
+                }
+              },
+              "mappings": [],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{instance=\"server1.infra.rd:9100\", job=\"linux\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "server1.infra.rd"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{instance=\"server2.infra.rd:9100\", job=\"linux\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "server2.infra.rd"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{instance=\"localhost:9100\", job=\"node\"}"
+                },
+                "properties": [
+                  {
+                    "id": "custom.hideFrom",
+                    "value": {
+                      "legend": true,
+                      "tooltip": true,
+                      "viz": true
+                    }
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 0,
+            "y": 1
+          },
+          "id": 4,
+          "options": {
+            "legend": {
+              "calcs": [],
+              "displayMode": "list",
+              "placement": "bottom",
+              "showLegend": true
+            },
+            "tooltip": {
+              "mode": "single",
+              "sort": "none"
+            }
+          },
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "code",
+              "expr": "node_memory_Active_bytes/node_memory_MemTotal_bytes*100",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "Memory usage %",
+          "type": "timeseries"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "palette-classic"
+              },
+              "custom": {
+                "axisCenteredZero": false,
+                "axisColorMode": "text",
+                "axisLabel": "",
+                "axisPlacement": "auto",
+                "barAlignment": 0,
+                "drawStyle": "line",
+                "fillOpacity": 0,
+                "gradientMode": "none",
+                "hideFrom": {
+                  "legend": false,
+                  "tooltip": false,
+                  "viz": false
+                },
+                "lineInterpolation": "linear",
+                "lineWidth": 4,
+                "pointSize": 5,
+                "scaleDistribution": {
+                  "type": "linear"
+                },
+                "showPoints": "auto",
+                "spanNulls": false,
+                "stacking": {
+                  "group": "A",
+                  "mode": "none"
+                },
+                "thresholdsStyle": {
+                  "mode": "dashed"
+                }
+              },
+              "mappings": [],
+              "thresholds": {
+                "mode": "percentage",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "blue",
+                    "value": 80
+                  },
+                  {
+                    "color": "red",
+                    "value": 90
+                  }
+                ]
+              }
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{cpu=\"0\", instance=\"server1.infra.rd:9100\", job=\"linux\", mode=\"idle\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "server1.infra.rd"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{cpu=\"0\", instance=\"server2.infra.rd:9100\", job=\"linux\", mode=\"idle\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "server2.infra.rd"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{instance=\"localhost:9100\", job=\"node\"}"
+                },
+                "properties": [
+                  {
+                    "id": "custom.hideFrom",
+                    "value": {
+                      "legend": true,
+                      "tooltip": true,
+                      "viz": true
+                    }
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 12,
+            "y": 1
+          },
+          "id": 5,
+          "options": {
+            "legend": {
+              "calcs": [],
+              "displayMode": "list",
+              "placement": "bottom",
+              "showLegend": true
+            },
+            "tooltip": {
+              "mode": "single",
+              "sort": "none"
+            }
+          },
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "code",
+              "expr": "rate(node_cpu_seconds_total{mode=\"idle\"}[1m])*100",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "CPU usage %",
+          "type": "timeseries"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "thresholds"
+              },
+              "mappings": [
+                {
+                  "options": {
+                    "0": {
+                      "color": "red",
+                      "index": 1,
+                      "text": "DOWN"
+                    },
+                    "1": {
+                      "color": "green",
+                      "index": 0,
+                      "text": "UP"
+                    }
+                  },
+                  "type": "value"
+                }
+              ],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"haproxy_up\", instance=\"server1.infra.rd:9101\", job=\"haproxy\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1:"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"haproxy_up\", instance=\"server2.infra.rd:9101\", job=\"haproxy\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2:"
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 0,
+            "y": 9
+          },
+          "id": 12,
+          "options": {
+            "colorMode": "value",
+            "graphMode": "area",
+            "justifyMode": "auto",
+            "orientation": "horizontal",
+            "reduceOptions": {
+              "calcs": [
+                "lastNotNull"
+              ],
+              "fields": "",
+              "values": false
+            },
+            "textMode": "auto"
+          },
+          "pluginVersion": "9.3.2",
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "builder",
+              "expr": "haproxy_up",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "HaProxy UP",
+          "type": "stat"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "thresholds"
+              },
+              "mappings": [
+                {
+                  "options": {
+                    "0": {
+                      "color": "red",
+                      "index": 1,
+                      "text": "DOWN"
+                    },
+                    "1": {
+                      "color": "green",
+                      "index": 0,
+                      "text": "UP"
+                    }
+                  },
+                  "type": "value"
+                }
+              ],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"haproxy_server_up\", backend=\"my_ha_frontend\", instance=\"server1.infra.rd:9101\", job=\"haproxy\", server=\"docker1\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1 - Docker1"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"haproxy_server_up\", backend=\"my_ha_frontend\", instance=\"server1.infra.rd:9101\", job=\"haproxy\", server=\"docker2\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1 - Docker 2"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"haproxy_server_up\", backend=\"my_ha_frontend\", instance=\"server2.infra.rd:9101\", job=\"haproxy\", server=\"docker1\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2 - Docker 1"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"haproxy_server_up\", backend=\"my_ha_frontend\", instance=\"server2.infra.rd:9101\", job=\"haproxy\", server=\"docker2\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2 - Docker 1"
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 12,
+            "y": 9
+          },
+          "id": 14,
+          "options": {
+            "colorMode": "value",
+            "graphMode": "area",
+            "justifyMode": "auto",
+            "orientation": "horizontal",
+            "reduceOptions": {
+              "calcs": [
+                "lastNotNull"
+              ],
+              "fields": "",
+              "values": false
+            },
+            "text": {
+              "titleSize": 12
+            },
+            "textMode": "auto"
+          },
+          "pluginVersion": "9.3.2",
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "builder",
+              "expr": "haproxy_server_up",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "Haproxy Server Up",
+          "type": "stat"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "thresholds"
+              },
+              "mappings": [
+                {
+                  "options": {
+                    "0": {
+                      "color": "red",
+                      "index": 1,
+                      "text": "DOWN"
+                    },
+                    "1": {
+                      "color": "green",
+                      "index": 0,
+                      "text": "UP"
+                    }
+                  },
+                  "type": "value"
+                }
+              ],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"bind_up\", instance=\"server1.infra.rd:9119\", job=\"bind9\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1:"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"bind_up\", instance=\"server2.infra.rd:9119\", job=\"bind9\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2:"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"bind_up\", instance=\"server3.infra.rd:9119\", job=\"bind9\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Monitoring:"
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 0,
+            "y": 17
+          },
+          "id": 7,
+          "options": {
+            "colorMode": "value",
+            "graphMode": "area",
+            "justifyMode": "auto",
+            "orientation": "horizontal",
+            "reduceOptions": {
+              "calcs": [
+                "lastNotNull"
+              ],
+              "fields": "",
+              "values": false
+            },
+            "textMode": "auto"
+          },
+          "pluginVersion": "9.3.2",
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "code",
+              "expr": "bind_up",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "Bind Status",
+          "type": "stat"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "palette-classic"
+              },
+              "custom": {
+                "axisCenteredZero": false,
+                "axisColorMode": "text",
+                "axisLabel": "",
+                "axisPlacement": "auto",
+                "barAlignment": 0,
+                "drawStyle": "line",
+                "fillOpacity": 0,
+                "gradientMode": "none",
+                "hideFrom": {
+                  "legend": false,
+                  "tooltip": false,
+                  "viz": false
+                },
+                "lineInterpolation": "linear",
+                "lineWidth": 3,
+                "pointSize": 5,
+                "scaleDistribution": {
+                  "type": "linear"
+                },
+                "showPoints": "auto",
+                "spanNulls": false,
+                "stacking": {
+                  "group": "A",
+                  "mode": "none"
+                },
+                "thresholdsStyle": {
+                  "mode": "off"
+                }
+              },
+              "mappings": [],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": []
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 12,
+            "y": 17
+          },
+          "id": 10,
+          "options": {
+            "legend": {
+              "calcs": [],
+              "displayMode": "list",
+              "placement": "bottom",
+              "showLegend": true
+            },
+            "tooltip": {
+              "mode": "single",
+              "sort": "none"
+            }
+          },
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "code",
+              "expr": "bind_resolver_queries_total",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "Total Bind Queries",
+          "type": "timeseries"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "thresholds"
+              },
+              "mappings": [
+                {
+                  "options": {
+                    "0": {
+                      "color": "red",
+                      "index": 0,
+                      "text": "DOWN"
+                    },
+                    "1": {
+                      "color": "green",
+                      "index": 1,
+                      "text": "UP"
+                    }
+                  },
+                  "type": "value"
+                }
+              ],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"keepalived_up\", instance=\"server1.infra.rd:9165\", job=\"keepalived\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1:"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"keepalived_up\", instance=\"server2.infra.rd:9165\", job=\"keepalived\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2:"
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 7,
+            "w": 12,
+            "x": 0,
+            "y": 25
+          },
+          "id": 18,
+          "options": {
+            "colorMode": "value",
+            "graphMode": "area",
+            "justifyMode": "auto",
+            "orientation": "horizontal",
+            "reduceOptions": {
+              "calcs": [
+                "lastNotNull"
+              ],
+              "fields": "",
+              "values": false
+            },
+            "textMode": "auto"
+          },
+          "pluginVersion": "9.3.2",
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "builder",
+              "expr": "keepalived_up",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "Keepalived UP",
+          "type": "stat"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "thresholds"
+              },
+              "mappings": [
+                {
+                  "options": {
+                    "1": {
+                      "color": "yellow",
+                      "index": 1,
+                      "text": "BACKUP"
+                    },
+                    "2": {
+                      "color": "green",
+                      "index": 0,
+                      "text": "MASTER"
+                    }
+                  },
+                  "type": "value"
+                },
+                {
+                  "options": {
+                    "match": "null",
+                    "result": {
+                      "color": "purple",
+                      "index": 2,
+                      "text": "?"
+                    }
+                  },
+                  "type": "special"
+                }
+              ],
+              "noValue": "?",
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"keepalived_vrrp_state\", iname=\"AGAMA\", instance=\"server1.infra.rd:9165\", intf=\"ens3\", ip_address=\"192.168.100.161/24\", job=\"keepalived\", vrid=\"2\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1 .100"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"keepalived_vrrp_state\", iname=\"AGAMA\", instance=\"server1.infra.rd:9165\", intf=\"ens3\", ip_address=\"192.168.101.161/24\", job=\"keepalived\", vrid=\"2\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1 .101"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"keepalived_vrrp_state\", iname=\"AGAMA\", instance=\"server2.infra.rd:9165\", intf=\"ens3\", ip_address=\"192.168.100.161/24\", job=\"keepalived\", vrid=\"2\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2 .100"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"keepalived_vrrp_state\", iname=\"AGAMA\", instance=\"server2.infra.rd:9165\", intf=\"ens3\", ip_address=\"192.168.101.161/24\", job=\"keepalived\", vrid=\"2\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2 .101"
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 7,
+            "w": 12,
+            "x": 12,
+            "y": 25
+          },
+          "id": 16,
+          "options": {
+            "colorMode": "value",
+            "graphMode": "none",
+            "justifyMode": "auto",
+            "orientation": "auto",
+            "reduceOptions": {
+              "calcs": [
+                "lastNotNull"
+              ],
+              "fields": "",
+              "values": false
+            },
+            "text": {
+              "titleSize": 12
+            },
+            "textMode": "auto"
+          },
+          "pluginVersion": "9.3.2",
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "code",
+              "expr": "keepalived_vrrp_state",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "VRRP State",
+          "type": "stat"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "thresholds"
+              },
+              "mappings": [
+                {
+                  "options": {
+                    "0": {
+                      "color": "red",
+                      "index": 1,
+                      "text": "DOWN"
+                    },
+                    "1": {
+                      "color": "green",
+                      "index": 0,
+                      "text": "UP"
+                    }
+                  },
+                  "type": "value"
+                },
+                {
+                  "options": {
+                    "match": "null+nan",
+                    "result": {
+                      "color": "blue",
+                      "index": 2,
+                      "text": "?"
+                    }
+                  },
+                  "type": "special"
+                },
+                {
+                  "options": {
+                    "match": "empty",
+                    "result": {
+                      "index": 3,
+                      "text": "e"
+                    }
+                  },
+                  "type": "special"
+                },
+                {
+                  "options": {
+                    "match": "null+nan",
+                    "result": {
+                      "index": 4,
+                      "text": "dsf"
+                    }
+                  },
+                  "type": "special"
+                }
+              ],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              },
+              "unit": "none"
+            },
+            "overrides": [
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"nginx_up\", instance=\"server1.infra.rd:9113\", job=\"nginx\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 1:"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"nginx_up\", instance=\"server2.infra.rd:9113\", job=\"nginx\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Server 2:"
+                  }
+                ]
+              },
+              {
+                "matcher": {
+                  "id": "byName",
+                  "options": "{__name__=\"nginx_up\", instance=\"server3.infra.rd:9113\", job=\"nginx\"}"
+                },
+                "properties": [
+                  {
+                    "id": "displayName",
+                    "value": "Monitoring server:"
+                  }
+                ]
+              }
+            ]
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 0,
+            "y": 32
+          },
+          "id": 8,
+          "options": {
+            "colorMode": "value",
+            "graphMode": "area",
+            "justifyMode": "auto",
+            "orientation": "horizontal",
+            "reduceOptions": {
+              "calcs": [
+                "lastNotNull"
+              ],
+              "fields": "",
+              "values": false
+            },
+            "textMode": "auto"
+          },
+          "pluginVersion": "9.3.2",
+          "targets": [
+            {
+              "datasource": {
+                "type": "prometheus",
+                "uid": "PBFA97CFB590B2093"
+              },
+              "editorMode": "builder",
+              "expr": "nginx_up",
+              "legendFormat": "__auto",
+              "range": true,
+              "refId": "A"
+            }
+          ],
+          "title": "NGINX Status",
+          "type": "stat"
+        },
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P0E6B6F82A46E86A5"
+          },
+          "fieldConfig": {
+            "defaults": {
+              "color": {
+                "mode": "palette-classic"
+              },
+              "custom": {
+                "axisCenteredZero": false,
+                "axisColorMode": "text",
+                "axisLabel": "",
+                "axisPlacement": "auto",
+                "barAlignment": 0,
+                "drawStyle": "line",
+                "fillOpacity": 0,
+                "gradientMode": "none",
+                "hideFrom": {
+                  "legend": false,
+                  "tooltip": false,
+                  "viz": false
+                },
+                "lineInterpolation": "linear",
+                "lineWidth": 1,
+                "pointSize": 5,
+                "scaleDistribution": {
+                  "type": "linear"
+                },
+                "showPoints": "auto",
+                "spanNulls": false,
+                "stacking": {
+                  "group": "A",
+                  "mode": "none"
+                },
+                "thresholdsStyle": {
+                  "mode": "off"
+                }
+              },
+              "mappings": [],
+              "thresholds": {
+                "mode": "absolute",
+                "steps": [
+                  {
+                    "color": "green",
+                    "value": null
+                  },
+                  {
+                    "color": "red",
+                    "value": 80
+                  }
+                ]
+              }
+            },
+            "overrides": []
+          },
+          "gridPos": {
+            "h": 8,
+            "w": 12,
+            "x": 12,
+            "y": 32
+          },
+          "id": 2,
+          "options": {
+            "legend": {
+              "calcs": [],
+              "displayMode": "list",
+              "placement": "bottom",
+              "showLegend": true
+            },
+            "tooltip": {
+              "mode": "single",
+              "sort": "none"
+            }
+          },
+          "targets": [
+            {
+              "datasource": {
+                "type": "influxdb",
+                "uid": "P0E6B6F82A46E86A5"
+              },
+              "groupBy": [
+                {
+                  "params": [
+                    "$__interval"
+                  ],
+                  "type": "time"
+                },
+                {
+                  "params": [
+                    "null"
+                  ],
+                  "type": "fill"
+                }
+              ],
+              "measurement": "rtt",
+              "orderByTime": "ASC",
+              "policy": "default",
+              "refId": "A",
+              "resultFormat": "time_series",
+              "select": [
+                [
+                  {
+                    "params": [
+                      "rtt"
+                    ],
+                    "type": "field"
+                  },
+                  {
+                    "params": [],
+                    "type": "mean"
+                  }
+                ]
+              ],
+              "tags": []
+            }
+          ],
+          "title": "Latency",
+          "type": "timeseries"
+        }
+      ],
+      "title": "Stats",
+      "type": "row"
+    },
+    {
+      "collapsed": false,
+      "gridPos": {
+        "h": 1,
+        "w": 24,
+        "x": 0,
+        "y": 1
+      },
+      "id": 29,
+      "panels": [],
+      "title": "Exporters",
+      "type": "row"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server1.infra.rd:9100\", job=\"linux\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server2.infra.rd:9100\", job=\"linux\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server2"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server3.infra.rd:9100\", job=\"linux\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server3"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 24,
+        "x": 0,
+        "y": 2
+      },
+      "id": 24,
+      "options": {
+        "colorMode": "background",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"linux\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Node Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server1.infra.rd:9113\", job=\"nginx\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "AGAMA 1"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server2.infra.rd:9113\", job=\"nginx\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "AGAMA 2"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server3.infra.rd:9113\", job=\"nginx\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "MONITORING"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 0,
+        "y": 9
+      },
+      "id": 20,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"nginx\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx Expoter Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server1.infra.rd:9101\", job=\"haproxy\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server2.infra.rd:9101\", job=\"haproxy\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server2"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 6,
+        "y": 9
+      },
+      "id": 27,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"haproxy\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Haproxy exporter",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server1.infra.rd:9165\", job=\"keepalived\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server2.infra.rd:9165\", job=\"keepalived\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 2"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 12,
+        "y": 9
+      },
+      "id": 25,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"keepalived\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Keepalived exporter",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server1.infra.rd:9119\", job=\"bind9\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server2.infra.rd:9119\", job=\"bind9\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 2"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server3.infra.rd:9119\", job=\"bind9\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 3"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 18,
+        "y": 9
+      },
+      "id": 22,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"bind9\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9 Exporter",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server1.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 1"
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server2.infra.rd:9104\", job=\"mysql\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 2"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 17
+      },
+      "id": 26,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"mysql\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Exporter",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server3.infra.rd:9424\", job=\"influxdb\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 3"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 12,
+        "y": 17
+      },
+      "id": 32,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"influxdb\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "InfluxDB",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "dark-red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "dark-green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "{__name__=\"up\", instance=\"server3.infra.rd:9424\", job=\"influxdb\"}"
+            },
+            "properties": [
+              {
+                "id": "displayName",
+                "value": "Server 3"
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 18,
+        "y": 17
+      },
+      "id": 33,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "up{job=\"prometheus\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "PRM Exporter",
+      "type": "stat"
+    }
+  ],
+  "refresh": "5s",
+  "schemaVersion": 37,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "Main",
+  "uid": "Zv5JH2cVk",
+  "version": 1,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/main.json)
--- before
+++ after: /Users/admin/CLionProjects/ica0002/roles/grafana/files/syslog.json
@@ -0,0 +1,1029 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "datasource",
+          "uid": "grafana"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "description": "Telegraf / InfluxDB / Grafana as syslog receiver",
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "gnetId": 12433,
+  "graphTooltip": 0,
+  "id": 3,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "aliasColors": {},
+      "bars": true,
+      "dashLength": 10,
+      "dashes": false,
+      "datasource": {
+        "type": "influxdb",
+        "uid": "PA97311C316D0457A"
+      },
+      "decimals": 0,
+      "fill": 1,
+      "fillGradient": 0,
+      "gridPos": {
+        "h": 7,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "hiddenSeries": false,
+      "id": 10,
+      "interval": "",
+      "legend": {
+        "alignAsTable": true,
+        "avg": true,
+        "current": false,
+        "max": true,
+        "min": false,
+        "rightSide": true,
+        "show": true,
+        "total": true,
+        "values": true
+      },
+      "lines": false,
+      "linewidth": 1,
+      "links": [],
+      "nullPointMode": "connected",
+      "options": {
+        "alertThreshold": true
+      },
+      "percentage": false,
+      "pluginVersion": "9.3.1",
+      "pointradius": 2,
+      "points": false,
+      "renderer": "flot",
+      "seriesOverrides": [
+        {
+          "alias": "Info",
+          "color": "rgb(80, 80, 80)",
+          "stack": "A"
+        },
+        {
+          "alias": "Notice",
+          "color": "rgb(182, 182, 182)",
+          "stack": "A"
+        },
+        {
+          "alias": "Warning",
+          "color": "#E0B400",
+          "stack": "A"
+        },
+        {
+          "alias": "Error",
+          "color": "#FF780A",
+          "stack": "A"
+        },
+        {
+          "alias": "Critical",
+          "color": "#E02F44",
+          "stack": "A"
+        },
+        {
+          "alias": "Alert",
+          "color": "#8F3BB8",
+          "stack": "A"
+        },
+        {
+          "alias": "Emergency",
+          "color": "#8F3BB8",
+          "stack": "A"
+        }
+      ],
+      "spaceLength": 10,
+      "stack": false,
+      "steppedLine": false,
+      "targets": [
+        {
+          "alias": "Info",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "info"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Notice",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "B",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "notice"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Warning",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "D",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "warning"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Error",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "C",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "err"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Critical",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "E",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "crit"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Alert",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "F",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "alert"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Emergency",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "G",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "emerg"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "thresholds": [],
+      "timeRegions": [],
+      "title": "syslog count",
+      "tooltip": {
+        "shared": true,
+        "sort": 0,
+        "value_type": "individual"
+      },
+      "type": "graph",
+      "xaxis": {
+        "mode": "time",
+        "show": true,
+        "values": []
+      },
+      "yaxes": [
+        {
+          "decimals": 0,
+          "format": "none",
+          "label": "Messages / min",
+          "logBase": 1,
+          "show": true
+        },
+        {
+          "format": "short",
+          "logBase": 1,
+          "show": false
+        }
+      ],
+      "yaxis": {
+        "align": false
+      }
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "PA97311C316D0457A"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "custom": {
+            "align": "left",
+            "displayMode": "auto",
+            "filterable": false,
+            "inspect": false
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-purple",
+                "value": null
+              },
+              {
+                "color": "dark-red",
+                "value": 2
+              },
+              {
+                "color": "dark-orange",
+                "value": 3
+              },
+              {
+                "color": "dark-yellow",
+                "value": 4
+              },
+              {
+                "color": "rgb(150, 150, 150)",
+                "value": 5
+              },
+              {
+                "color": "rgb(51, 51, 51)",
+                "value": 6
+              },
+              {
+                "color": "rgb(5, 5, 5)",
+                "value": 7
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "severity_code"
+            },
+            "properties": [
+              {
+                "id": "mappings",
+                "value": [
+                  {
+                    "options": {
+                      "0": {
+                        "text": "Emergency"
+                      },
+                      "1": {
+                        "text": "Alert"
+                      },
+                      "2": {
+                        "text": "Critical"
+                      },
+                      "3": {
+                        "text": "Error"
+                      },
+                      "4": {
+                        "text": "Warning"
+                      },
+                      "5": {
+                        "text": "Notice"
+                      },
+                      "6": {
+                        "text": "Info"
+                      },
+                      "7": {
+                        "text": "Debug"
+                      }
+                    },
+                    "type": "value"
+                  }
+                ]
+              },
+              {
+                "id": "custom.displayMode",
+                "value": "color-background"
+              },
+              {
+                "id": "custom.width",
+                "value": 119
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Time"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 163
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "hostname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 194
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "appname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 264
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 24,
+        "w": 24,
+        "x": 0,
+        "y": 7
+      },
+      "id": 12,
+      "options": {
+        "footer": {
+          "fields": "",
+          "reducer": [
+            "sum"
+          ],
+          "show": false
+        },
+        "showHeader": true,
+        "sortBy": [
+          {
+            "desc": true,
+            "displayName": "Time"
+          }
+        ]
+      },
+      "pluginVersion": "9.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PA97311C316D0457A"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "hostname"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "appname"
+              ],
+              "type": "tag"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "table",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              }
+            ],
+            [
+              {
+                "params": [
+                  "message"
+                ],
+                "type": "field"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "title": "Syslog Messages",
+      "type": "table"
+    }
+  ],
+  "refresh": "5s",
+  "schemaVersion": 37,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": [
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "influxdb",
+          "uid": "PA97311C316D0457A"
+        },
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "hide": 0,
+        "includeAll": true,
+        "label": "Appname",
+        "multi": true,
+        "name": "appname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "tagValuesQuery": "",
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "influxdb",
+          "uid": "PA97311C316D0457A"
+        },
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "hide": 0,
+        "includeAll": true,
+        "label": "Hostname",
+        "multi": true,
+        "name": "hostname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "tagValuesQuery": "",
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "allValue": "",
+        "current": {
+          "selected": false,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "influxdb",
+          "uid": "PA97311C316D0457A"
+        },
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "hide": 0,
+        "includeAll": true,
+        "label": "Severity",
+        "multi": true,
+        "name": "severity",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "refresh": 2,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 0,
+        "tagValuesQuery": "",
+        "tagsQuery": "",
+        "type": "query",
+        "useTags": false
+      },
+      {
+        "current": {
+          "selected": false,
+          "text": "",
+          "value": ""
+        },
+        "description": "Querystring",
+        "hide": 0,
+        "label": "MessageQuery",
+        "name": "Query",
+        "options": [
+          {
+            "selected": true,
+            "text": "",
+            "value": ""
+          }
+        ],
+        "query": "",
+        "skipUrlSync": false,
+        "type": "textbox"
+      }
+    ]
+  },
+  "time": {
+    "from": "now-1h",
+    "to": "now"
+  },
+  "timepicker": {
+    "refresh_intervals": [
+      "5s",
+      " 10s",
+      " 30s",
+      " 1m",
+      " 5m"
+    ],
+    "time_options": [
+      "5m",
+      "15m",
+      "1h",
+      "6h",
+      "12h",
+      "24h",
+      "2d",
+      "7d",
+      "30d"
+    ]
+  },
+  "timezone": "",
+  "title": "Syslogs",
+  "uid": "TIYeHqRgE",
+  "version": 2,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/syslog.json)

TASK [grafana : grafana container] *********************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [server3]

RUNNING HANDLER [grafana : stop] ***********************************************
--- before
+++ after
@@ -1,3 +1,3 @@
 {
-    "running": true
+    "running": false
 }

changed: [server3]

RUNNING HANDLER [grafana : start] **********************************************
--- before
+++ after
@@ -1,3 +1,3 @@
 {
-    "running": false
+    "running": true
 }

changed: [server3]

PLAY [DNS Nameserver conf] *****************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [dns_resolve : systemdresolved stop] **************************************
changed: [server2]
changed: [server1]
changed: [server3]

TASK [dns_resolve : CP Dns config] *********************************************
--- before: /etc/resolv.conf
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpzj42zm6z/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.81
+nameserver 192.168.43.191
+search infra.rd

changed: [server1]
--- before: /etc/resolv.conf
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp7e2z0vj2/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.81
+nameserver 192.168.43.191
+search infra.rd

changed: [server2]
--- before: /etc/resolv.conf
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp7kdqfia3/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.81
+nameserver 192.168.43.191
+search infra.rd

changed: [server3]

PLAY [MySQL exporter] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [mysql_exporter : Copy config] ********************************************
changed: [server2]
changed: [server1]

TASK [mysql_exporter : Copy prometheus conf] ***********************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpcv1yqa7g/prometheus-mysqld-exporter.j2
@@ -0,0 +1 @@
+ARGS="--collect.slave_status --web.listen-address=':9104'"
\ No newline at end of file

changed: [server2]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmplecxbye3/prometheus-mysqld-exporter.j2
@@ -0,0 +1 @@
+ARGS="--collect.slave_status --web.listen-address=':9104'"
\ No newline at end of file

changed: [server1]

TASK [mysql_exporter : mysql exporter installed] *******************************
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [server2]
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [server1]

TASK [mysql_exporter : start mysql exporter] ***********************************
ok: [server2]
ok: [server1]

RUNNING HANDLER [mysql_exporter : restart] *************************************
changed: [server2]
changed: [server1]

PLAY [Logging] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [influxdb : ensure influxdb and -client are installed] ********************
The following NEW packages will be installed:
  influxdb influxdb-client
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [server3]

TASK [influxdb : download telegraf v1.24.2] ************************************
changed: [server3]

TASK [influxdb : install telegraf] *********************************************
Selecting previously unselected package telegraf.
(Reading database ... 66372 files and directories currently installed.)
Preparing to unpack .../telegraf_1.24.2-1_amd64.deb ...
Unpacking telegraf (1.24.2-1) ...
Setting up telegraf (1.24.2-1) ...
changed: [server3]

TASK [influxdb : configure telegraf] *******************************************
diff skipped: destination file size is greater than 104448
changed: [server3]

TASK [influxdb : influxdb started, enabled] ************************************
ok: [server3]

TASK [influxdb : telegraf started, enabled] ************************************
ok: [server3]

TASK [influxdb_backup : influxdb backup directory] *****************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0774",
+    "owner": 34,
     "path": "/home/backup/influxdb",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server3]

TASK [influxdb_backup : influxdb backup cronjob] *******************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpisszuwbj/influxdb_backup.j2
@@ -0,0 +1,3 @@
+10 0 * * * backup rm -rf /home/backup/influxdb/*; influxd backup -portable -database telegraf /home/backup/influxdb
+0 1 * * 0  backup duplicity --no-encryption full /home/backup/influxdb/ rsync://redubr@backup.infra.rd/influxdb
+0 1 * * 1-6  backup duplicity --no-encryption incremental /home/backup/influxdb/ rsync://redubr@backup.infra.rd/influxdb

changed: [server3]

TASK [pinger : ensure fping installed] *****************************************
The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server3]

TASK [pinger : Create user pinger] *********************************************
changed: [server3]

TASK [pinger : Pinger config] **************************************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "mode": "0755",
+    "mode": "0751",
     "path": "/etc/pinger",
-    "state": "absent"
+    "state": "directory"
 }

changed: [server3]

TASK [pinger : Copy pinger conf] ***********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp1nqfcnlu/pinger.conf.j2
@@ -0,0 +1,3 @@
+database_url=http://server3.infra.rd:8086
+database_name=latency
+targets=google.com,cloudflare.com,twitter.com,facebook.com
\ No newline at end of file

changed: [server3]

TASK [pinger : Copy pinger script] *********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpukvxb1s8/pinger.sh.j2
@@ -0,0 +1,26 @@
+#!/bin/bash
+
+# Script contains several (more than 1) security issues.
+# Find them and fix them to get bonus on exam.
+# Problem example: SQL injection.
+
+for t in database_url database_name targets; do
+  if ! grep -q "^${t}=" /etc/pinger/pinger.conf; then
+    logger "$0 Failed to get $t from config"
+    exit 1
+  fi
+done
+
+which fping > /dev/null || (logger "fping not found"; exit 1)
+
+db_url=$(grep "^database_url=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+db_name=$(grep "^database_name=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+targets=$(grep "^targets=" /etc/pinger/pinger.conf | sed 's/^.*=//' | sed 's/\(,\|;\)/ /g')
+
+curl -i -XPOST "${db_url}/query" --data-urlencode "q=CREATE DATABASE $db_name" 1>/dev/null 2>/dev/null
+
+while true; do
+  result=$(fping -C1 -q $targets 2>&1 | awk '{print "rtt,dst="$1" rtt="$3}')
+  curl -i -XPOST "${db_url}/write?db=$db_name" --data-binary "$result" 1>/dev/null 2>/dev/null
+ sleep 1
+done
\ No newline at end of file

changed: [server3]

TASK [pinger : Copy pinger service] ********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmptrwk3x7o/pinger.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=pinger service
+Documentation=https://github.com/romankuchin/ica0002-2022/blob/main/08-logging/08-files/pinger.service
+After=network-online.target
+
+[Service]
+User=pinger
+ExecStart=/usr/local/bin/pinger
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [server3]

TASK [pinger : Start and enable pinger] ****************************************
changed: [server3]

RUNNING HANDLER [influxdb : restarted telegraf] ********************************
changed: [server3]

RUNNING HANDLER [pinger : daemon-reload] ***************************************
changed: [server3]

RUNNING HANDLER [pinger : restart] *********************************************
changed: [server3]

PLAY [Keepalived/HA] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [keepalived : ensure keepalived and netstat installed] ********************
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35 net-tools
0 upgraded, 10 newly installed, 0 to remove and 228 not upgraded.
changed: [server1]
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35 net-tools
0 upgraded, 10 newly installed, 0 to remove and 228 not upgraded.
changed: [server2]

TASK [keepalived : keepalived script user] *************************************
changed: [server2]
changed: [server1]

TASK [keepalived : Configure keepalived] ***************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpzhe651hd/keepalived.conf.j2
@@ -0,0 +1,25 @@
+global_defs {
+      enable_script_security
+}
+
+vrrp_track_process check_haproxy {
+    process haproxy
+    quorum 1
+    delay 2
+}
+
+vrrp_instance AGAMA {
+    interface ens3
+    virtual_router_id 2
+        priority 100
+        advert_int 1
+    virtual_ipaddress {
+                192.168.101.81/24
+            }
+    unicast_peer {
+                                          192.168.43.191
+                    }
+    track_process {
+        check_haproxy
+    }
+}
\ No newline at end of file

changed: [server1]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmppz1ah9z1/keepalived.conf.j2
@@ -0,0 +1,25 @@
+global_defs {
+      enable_script_security
+}
+
+vrrp_track_process check_haproxy {
+    process haproxy
+    quorum 1
+    delay 2
+}
+
+vrrp_instance AGAMA {
+    interface ens3
+    virtual_router_id 2
+        priority 99
+        advert_int 1
+    virtual_ipaddress {
+                192.168.101.81/24
+            }
+    unicast_peer {
+                          192.168.43.81
+                                    }
+    track_process {
+        check_haproxy
+    }
+}
\ No newline at end of file

changed: [server2]

TASK [keepalived : download and unzip keepalived exporter] *********************
changed: [server1]
changed: [server2]

TASK [keepalived : keepalived exporter environment] ****************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmph02_ke03/keepalived-exporter.j2
@@ -0,0 +1 @@
+ARGS="-web.listen-address ':9165'"
\ No newline at end of file

changed: [server1]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp5urexycx/keepalived-exporter.j2
@@ -0,0 +1 @@
+ARGS="-web.listen-address ':9165'"
\ No newline at end of file

changed: [server2]

TASK [keepalived : start keepalived] *******************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpkwhjf9u2/keepalived-exporter.service.j2
@@ -0,0 +1,12 @@
+[Unit]
+Description=Keepalived exporter
+Documentation=https://github.com/cafebazaar/keepalived-exporter
+
+[Service]
+Restart=always
+User=root
+EnvironmentFile=/etc/default/keepalived-exporter
+ExecStart=/usr/local/bin/keepalived-exporter-1.2.0.linux-amd64/keepalived-exporter $ARGS
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [server1]
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmplgaoahry/keepalived-exporter.service.j2
@@ -0,0 +1,12 @@
+[Unit]
+Description=Keepalived exporter
+Documentation=https://github.com/cafebazaar/keepalived-exporter
+
+[Service]
+Restart=always
+User=root
+EnvironmentFile=/etc/default/keepalived-exporter
+ExecStart=/usr/local/bin/keepalived-exporter-1.2.0.linux-amd64/keepalived-exporter $ARGS
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [server2]

TASK [keepalived : enable keepalived] ******************************************
changed: [server2]
changed: [server1]

TASK [keepalived : enable keepalived-exporter] *********************************
changed: [server2]
changed: [server1]

TASK [haproxy : Ensure haproxy isnstalled] *************************************
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [server2]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 228 not upgraded.
changed: [server1]

TASK [haproxy : Haproxy exporter] **********************************************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server1]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server2]

TASK [haproxy : cp conf] *******************************************************
--- before: /etc/haproxy/haproxy.cfg
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp5f4r0gnb/haproxy.cfg.j2
@@ -7,15 +7,6 @@
 	user haproxy
 	group haproxy
 	daemon
-
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +23,10 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen my_ha_frontend
+    stats enable
+    stats uri /stats
+    bind :88
+    server docker1 server1.infra.rd:5000 check
+    server docker2 server2.infra.rd:5000 check
\ No newline at end of file

changed: [server2]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmpgn1ml42j/haproxy.cfg.j2
@@ -7,15 +7,6 @@
 	user haproxy
 	group haproxy
 	daemon
-
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +23,10 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen my_ha_frontend
+    stats enable
+    stats uri /stats
+    bind :88
+    server docker1 server1.infra.rd:5000 check
+    server docker2 server2.infra.rd:5000 check
\ No newline at end of file

changed: [server1]

TASK [haproxy : cp conf exporter] **********************************************
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmprltmusi5/prometheus-haproxy-exporter.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri="http://localhost:88/stats;csv --web.listen-address=':9101'"
\ No newline at end of file

changed: [server1]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp7bx81_bx/prometheus-haproxy-exporter.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri="http://localhost:88/stats;csv --web.listen-address=':9101'"
\ No newline at end of file

changed: [server2]

TASK [haproxy : enable haproxy] ************************************************
ok: [server1]
ok: [server2]

TASK [haproxy : enable haproxy exporter] ***************************************
ok: [server2]
ok: [server1]

RUNNING HANDLER [keepalived : daemon-reload] ***********************************
changed: [server1]
changed: [server2]

RUNNING HANDLER [keepalived : restart keepalived-exporter] *********************
changed: [server1]
changed: [server2]

RUNNING HANDLER [keepalived : restart haproxy] *********************************
changed: [server2]
changed: [server1]

RUNNING HANDLER [haproxy : restart] ********************************************
changed: [server2]
changed: [server1]

RUNNING HANDLER [haproxy : restart exp] ****************************************
changed: [server2]
changed: [server1]

PLAY [Exporters all] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [nginx_exporter : nginx exporter installed] *******************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server2]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server1]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 228 not upgraded.
changed: [server3]

TASK [nginx_exporter : cp template] ********************************************
--- before: /etc/default/prometheus-nginx-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp3g7vn8w1/nginx-exp.j2
@@ -1,14 +1 @@
-ARGS=""
-
-# Prometheus-nginx-exporter supports the following options:
-#  -nginx.plus
-#        Start the exporter for NGINX Plus. By default, the exporter is started
-#        for NGINX.
-#  -nginx.scrape-uri string
-#        A URI for scraping NGINX or NGINX Plus metrics.
-#        For NGINX, the stub_status page must be available through the URI.
-#        For NGINX Plus -- the API. (default "http://127.0.0.1:8080/stub_status")
-#  -web.listen-address string
-#        An address to listen on for web interface and telemetry. (default ":9113")
-#  -web.telemetry-path string
-#        A path under which to expose metrics. (default "/metrics"
+ARGS="-web.listen-address ':9113'"
\ No newline at end of file

changed: [server1]
--- before: /etc/default/prometheus-nginx-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp4k0rotk5/nginx-exp.j2
@@ -1,14 +1 @@
-ARGS=""
-
-# Prometheus-nginx-exporter supports the following options:
-#  -nginx.plus
-#        Start the exporter for NGINX Plus. By default, the exporter is started
-#        for NGINX.
-#  -nginx.scrape-uri string
-#        A URI for scraping NGINX or NGINX Plus metrics.
-#        For NGINX, the stub_status page must be available through the URI.
-#        For NGINX Plus -- the API. (default "http://127.0.0.1:8080/stub_status")
-#  -web.listen-address string
-#        An address to listen on for web interface and telemetry. (default ":9113")
-#  -web.telemetry-path string
-#        A path under which to expose metrics. (default "/metrics"
+ARGS="-web.listen-address ':9113'"
\ No newline at end of file

changed: [server3]
--- before: /etc/default/prometheus-nginx-exporter
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp92vsb_5b/nginx-exp.j2
@@ -1,14 +1 @@
-ARGS=""
-
-# Prometheus-nginx-exporter supports the following options:
-#  -nginx.plus
-#        Start the exporter for NGINX Plus. By default, the exporter is started
-#        for NGINX.
-#  -nginx.scrape-uri string
-#        A URI for scraping NGINX or NGINX Plus metrics.
-#        For NGINX, the stub_status page must be available through the URI.
-#        For NGINX Plus -- the API. (default "http://127.0.0.1:8080/stub_status")
-#  -web.listen-address string
-#        An address to listen on for web interface and telemetry. (default ":9113")
-#  -web.telemetry-path string
-#        A path under which to expose metrics. (default "/metrics"
+ARGS="-web.listen-address ':9113'"
\ No newline at end of file

changed: [server2]

TASK [nginx_exporter : start and enable nginx exporter] ************************
ok: [server1]
ok: [server2]
ok: [server3]

RUNNING HANDLER [nginx_exporter : restart] *************************************
changed: [server3]
changed: [server1]
changed: [server2]

PLAY [Exporter influxdb] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [influxdb_exporter : Download influxstats exporter] ***********************
changed: [server3]

TASK [influxdb_exporter : Env file] ********************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp2tkr6sf9/influx-env.j2
@@ -0,0 +1 @@
+ARGS="--web.listen-address ':9424'"
\ No newline at end of file

changed: [server3]

TASK [influxdb_exporter : CP Service] ******************************************
--- before
+++ after: /Users/admin/.ansible/tmp/ansible-local-56219nyz177ns/tmp326t8iyx/influxdb-stats-exporter.service.j2
@@ -0,0 +1,12 @@
+[Unit]
+Description=Influxdb stats exporter
+Documentation=https://github.com/carlpett/influxdb_stats_exporter
+After=network-online.target
+
+[Service]
+User=prometheus
+EnvironmentFile=/etc/default/influx-env
+ExecStart=/usr/local/bin/influxdb-stats-exporter $ARGS
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [server3]

TASK [influxdb_exporter : Enable exporter] *************************************
changed: [server3]

RUNNING HANDLER [influxdb_exporter : restart] **********************************
changed: [server3]

RUNNING HANDLER [influxdb_exporter : daemon-reload] ****************************
changed: [server3]

PLAY RECAP *********************************************************************
server1                    : ok=90   changed=70   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
server2                    : ok=90   changed=70   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
server3                    : ok=91   changed=71   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ ansible-playbook infra.yaml --diff

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [init : Update cache for apt] *********************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [node_exporter : NodeExporter and nginx installed] ************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [node_exporter : cp conf] *************************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [node_exporter : Enable node exporter] ************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [users : Add user roman] **************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [users : Add user juri] ***************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [users : Ssh key for roman] ***********************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [users : Ssh key for juri] ************************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [rsyslog : ensure ryslog is installed] ************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [rsyslog : copy configuration] ********************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [rsyslog : enable rsyslog] ************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [backup : backup user] ****************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [backup : copy known hosts] ***********************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [backup : restore directory] **********************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [backup : ensure duplicity is installed] **********************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [docker : ensure docker is installed] *************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [docker : docker enabled] *************************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [nginx : Ensure Nginx is installed] ***************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [nginx : start nginx] *****************************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [nginx : Copy template to server] *****************************************
ok: [server2]
ok: [server1]
ok: [server3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server1]
ok: [server2]

TASK [mysql : Ensure mysql server is installed] ********************************
ok: [server2]
ok: [server1]

TASK [mysql : Configure] *******************************************************
ok: [server2]
ok: [server1]

TASK [mysql : MySql started and enabled] ***************************************
ok: [server2]
ok: [server1]

TASK [mysql : Add MySQL Database] **********************************************
ok: [server2]
ok: [server1]

TASK [mysql : Add MySQL user] **************************************************
ok: [server2]
ok: [server1]

TASK [mysql : MySql user for exporter] *****************************************
ok: [server1]
ok: [server2]

TASK [mysql : MySql user for replication] **************************************
ok: [server1]
ok: [server2]

TASK [mysql : replica server read_only] ****************************************
ok: [server2]
ok: [server1]

TASK [mysql_backup : mysql directory] ******************************************
ok: [server1]
ok: [server2]

TASK [mysql_backup : MySql user for backup] ************************************
ok: [server2]
ok: [server1]

TASK [mysql_backup : cp conf] **************************************************
ok: [server1]
ok: [server2]

TASK [mysql_backup : Cronjob cp] ***********************************************
ok: [server1]
ok: [server2]

PLAY [Web server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [agama : directory for agama] *********************************************
ok: [server1]
ok: [server2]

TASK [agama : agama dockerfile] ************************************************
ok: [server1]
ok: [server2]

TASK [agama : Get agama] *******************************************************
ok: [server1]
ok: [server2]

TASK [agama : agama docker image build] ****************************************
ok: [server1]
ok: [server2]

TASK [agama : start agama container] *******************************************
ok: [server2]
ok: [server1]

PLAY [DNS Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [Gather facts from ALL hosts (regardless of limit or tags)] ***************
skipping: [server3] => (item=server1) 
skipping: [server3] => (item=server2) 
skipping: [server3] => (item=server3) 
skipping: [server1] => (item=server1) 
skipping: [server1] => (item=server2) 
skipping: [server1] => (item=server3) 
skipping: [server2] => (item=server1) 
skipping: [server2] => (item=server2) 
skipping: [server2] => (item=server3) 

TASK [bind : install bind9] ****************************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [bind : Copy config] ******************************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [bind : Copy master zone db] **********************************************
skipping: [server1]
skipping: [server2]
ok: [server3]

TASK [bind : Copy reverse zone db] *********************************************
skipping: [server1]
skipping: [server2]
ok: [server3]

TASK [bind : CP local] *********************************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [bind : start bind9] ******************************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [bind : execute handlers] *************************************************

TASK [bind : wait] *************************************************************
Pausing for 15 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [server3]

TASK [bind : Add A records] ****************************************************
ok: [server3] => (item={'key': 'backup.infra.rd', 'value': '192.168.42.132'})

TASK [bind : Add CNAME records] ************************************************
ok: [server3] => (item={'key': 'grafana', 'value': 'server3'})
ok: [server3] => (item={'key': 'influxdb', 'value': 'server3'})
ok: [server3] => (item={'key': 'lb1', 'value': 'server1'})
ok: [server3] => (item={'key': 'lb2', 'value': 'server2'})
ok: [server3] => (item={'key': 'mysql1', 'value': 'server1'})
ok: [server3] => (item={'key': 'mysql2', 'value': 'server2'})
ok: [server3] => (item={'key': 'ns1', 'value': 'server1'})
ok: [server3] => (item={'key': 'ns2', 'value': 'server3'})
ok: [server3] => (item={'key': 'prometheus', 'value': 'server3'})
ok: [server3] => (item={'key': 'web1', 'value': 'server1'})
ok: [server3] => (item={'key': 'web2', 'value': 'server2'})

TASK [bind_exporter : Bind exporter installed] *********************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [bind_exporter : Copy args] ***********************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [bind_exporter : Enable bind exporter] ************************************
ok: [server2]
ok: [server1]
ok: [server3]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [prometheus : Prometheus installed] ***************************************
ok: [server3]

TASK [prometheus : CP ARGS] ****************************************************
ok: [server3]

TASK [prometheus : Copy conf] **************************************************
ok: [server3]

TASK [prometheus : Start prometheus] *******************************************
ok: [server3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [grafana : Create the grafana user] ***************************************
ok: [server3]

TASK [grafana : folder with correct permissions datasources] *******************
ok: [server3]

TASK [grafana : folder with correct permissions dashboards] ********************
ok: [server3]

TASK [grafana : Config] ********************************************************
ok: [server3]

TASK [grafana : Datasources] ***************************************************
ok: [server3]

TASK [grafana : dashboards yaml] ***********************************************
ok: [server3]

TASK [grafana : copy dashboards] ***********************************************
ok: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/mysql.json)
ok: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/main.json)
ok: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/syslog.json)

TASK [grafana : grafana container] *********************************************
ok: [server3]

PLAY [DNS Nameserver conf] *****************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [dns_resolve : systemdresolved stop] **************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [dns_resolve : CP Dns config] *********************************************
ok: [server1]
ok: [server3]
ok: [server2]

PLAY [MySQL exporter] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server1]
ok: [server2]

TASK [mysql_exporter : Copy config] ********************************************
ok: [server2]
ok: [server1]

TASK [mysql_exporter : Copy prometheus conf] ***********************************
ok: [server1]
ok: [server2]

TASK [mysql_exporter : mysql exporter installed] *******************************
ok: [server2]
ok: [server1]

TASK [mysql_exporter : start mysql exporter] ***********************************
ok: [server2]
ok: [server1]

PLAY [Logging] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [influxdb : ensure influxdb and -client are installed] ********************
ok: [server3]

TASK [influxdb : download telegraf v1.24.2] ************************************
ok: [server3]

TASK [influxdb : install telegraf] *********************************************
ok: [server3]

TASK [influxdb : configure telegraf] *******************************************
ok: [server3]

TASK [influxdb : influxdb started, enabled] ************************************
ok: [server3]

TASK [influxdb : telegraf started, enabled] ************************************
ok: [server3]

TASK [influxdb_backup : influxdb backup directory] *****************************
ok: [server3]

TASK [influxdb_backup : influxdb backup cronjob] *******************************
ok: [server3]

TASK [pinger : ensure fping installed] *****************************************
ok: [server3]

TASK [pinger : Create user pinger] *********************************************
ok: [server3]

TASK [pinger : Pinger config] **************************************************
ok: [server3]

TASK [pinger : Copy pinger conf] ***********************************************
ok: [server3]

TASK [pinger : Copy pinger script] *********************************************
ok: [server3]

TASK [pinger : Copy pinger service] ********************************************
ok: [server3]

TASK [pinger : Start and enable pinger] ****************************************
ok: [server3]

PLAY [Keepalived/HA] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [keepalived : ensure keepalived and netstat installed] ********************
ok: [server2]
ok: [server1]

TASK [keepalived : keepalived script user] *************************************
ok: [server1]
ok: [server2]

TASK [keepalived : Configure keepalived] ***************************************
ok: [server2]
ok: [server1]

TASK [keepalived : download and unzip keepalived exporter] *********************
ok: [server2]
ok: [server1]

TASK [keepalived : keepalived exporter environment] ****************************
ok: [server2]
ok: [server1]

TASK [keepalived : start keepalived] *******************************************
ok: [server1]
ok: [server2]

TASK [keepalived : enable keepalived] ******************************************
ok: [server1]
ok: [server2]

TASK [keepalived : enable keepalived-exporter] *********************************
ok: [server1]
ok: [server2]

TASK [haproxy : Ensure haproxy isnstalled] *************************************
ok: [server2]
ok: [server1]

TASK [haproxy : Haproxy exporter] **********************************************
ok: [server1]
ok: [server2]

TASK [haproxy : cp conf] *******************************************************
ok: [server2]
ok: [server1]

TASK [haproxy : cp conf exporter] **********************************************
ok: [server1]
ok: [server2]

TASK [haproxy : enable haproxy] ************************************************
ok: [server1]
ok: [server2]

TASK [haproxy : enable haproxy exporter] ***************************************
ok: [server1]
ok: [server2]

PLAY [Exporters all] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [nginx_exporter : nginx exporter installed] *******************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [nginx_exporter : cp template] ********************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [nginx_exporter : start and enable nginx exporter] ************************
ok: [server2]
ok: [server1]
ok: [server3]

PLAY [Exporter influxdb] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [influxdb_exporter : Download influxstats exporter] ***********************
ok: [server3]

TASK [influxdb_exporter : Env file] ********************************************
ok: [server3]

TASK [influxdb_exporter : CP Service] ******************************************
ok: [server3]

TASK [influxdb_exporter : Enable exporter] *************************************
ok: [server3]

PLAY RECAP *********************************************************************
server1                    : ok=75   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
server2                    : ok=75   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
server3                    : ok=76   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ ansible all -b -m reboot -a test_command=uptime
server3 | CHANGED => {
    "changed": true,
    "elapsed": 40,
    "rebooted": true
}
server1 | CHANGED => {
    "changed": true,
    "elapsed": 42,
    "rebooted": true
}
server2 | CHANGED => {
    "changed": true,
    "elapsed": 44,
    "rebooted": true
}
+ ansible-playbook infra.yaml --diff

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [init : Update cache for apt] *********************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [node_exporter : NodeExporter and nginx installed] ************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [node_exporter : cp conf] *************************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [node_exporter : Enable node exporter] ************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [users : Add user roman] **************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [users : Add user juri] ***************************************************
ok: [server3]
ok: [server1]
ok: [server2]

TASK [users : Ssh key for roman] ***********************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [users : Ssh key for juri] ************************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [rsyslog : ensure ryslog is installed] ************************************
ok: [server3]
ok: [server2]
ok: [server1]

TASK [rsyslog : copy configuration] ********************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [rsyslog : enable rsyslog] ************************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [backup : backup user] ****************************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [backup : copy known hosts] ***********************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [backup : restore directory] **********************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [backup : ensure duplicity is installed] **********************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [docker : ensure docker is installed] *************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [docker : docker enabled] *************************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [nginx : Ensure Nginx is installed] ***************************************
ok: [server1]
ok: [server3]
ok: [server2]

TASK [nginx : start nginx] *****************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [nginx : Copy template to server] *****************************************
ok: [server1]
ok: [server2]
ok: [server3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [mysql : Ensure mysql server is installed] ********************************
ok: [server2]
ok: [server1]

TASK [mysql : Configure] *******************************************************
ok: [server1]
ok: [server2]

TASK [mysql : MySql started and enabled] ***************************************
ok: [server2]
ok: [server1]

TASK [mysql : Add MySQL Database] **********************************************
ok: [server2]
ok: [server1]

TASK [mysql : Add MySQL user] **************************************************
ok: [server2]
ok: [server1]

TASK [mysql : MySql user for exporter] *****************************************
ok: [server1]
ok: [server2]

TASK [mysql : MySql user for replication] **************************************
ok: [server1]
ok: [server2]

TASK [mysql : replica server read_only] ****************************************
ok: [server2]
ok: [server1]

TASK [mysql_backup : mysql directory] ******************************************
ok: [server1]
ok: [server2]

TASK [mysql_backup : MySql user for backup] ************************************
ok: [server1]
ok: [server2]

TASK [mysql_backup : cp conf] **************************************************
ok: [server1]
ok: [server2]

TASK [mysql_backup : Cronjob cp] ***********************************************
ok: [server2]
ok: [server1]

PLAY [Web server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server1]
ok: [server2]

TASK [agama : directory for agama] *********************************************
ok: [server1]
ok: [server2]

TASK [agama : agama dockerfile] ************************************************
ok: [server2]
ok: [server1]

TASK [agama : Get agama] *******************************************************
ok: [server1]
ok: [server2]

TASK [agama : agama docker image build] ****************************************
ok: [server2]
ok: [server1]

TASK [agama : start agama container] *******************************************
ok: [server2]
ok: [server1]

PLAY [DNS Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [Gather facts from ALL hosts (regardless of limit or tags)] ***************
skipping: [server3] => (item=server1) 
skipping: [server3] => (item=server2) 
skipping: [server3] => (item=server3) 
skipping: [server1] => (item=server1) 
skipping: [server1] => (item=server2) 
skipping: [server1] => (item=server3) 
skipping: [server2] => (item=server1) 
skipping: [server2] => (item=server2) 
skipping: [server2] => (item=server3) 

TASK [bind : install bind9] ****************************************************
ok: [server2]
ok: [server3]
ok: [server1]

TASK [bind : Copy config] ******************************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [bind : Copy master zone db] **********************************************
skipping: [server1]
skipping: [server2]
ok: [server3]

TASK [bind : Copy reverse zone db] *********************************************
skipping: [server1]
skipping: [server2]
ok: [server3]

TASK [bind : CP local] *********************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [bind : start bind9] ******************************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [bind : execute handlers] *************************************************

TASK [bind : wait] *************************************************************
Pausing for 15 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [server3]

TASK [bind : Add A records] ****************************************************
ok: [server3] => (item={'key': 'backup.infra.rd', 'value': '192.168.42.132'})

TASK [bind : Add CNAME records] ************************************************
ok: [server3] => (item={'key': 'grafana', 'value': 'server3'})
ok: [server3] => (item={'key': 'influxdb', 'value': 'server3'})
ok: [server3] => (item={'key': 'lb1', 'value': 'server1'})
ok: [server3] => (item={'key': 'lb2', 'value': 'server2'})
ok: [server3] => (item={'key': 'mysql1', 'value': 'server1'})
ok: [server3] => (item={'key': 'mysql2', 'value': 'server2'})
ok: [server3] => (item={'key': 'ns1', 'value': 'server1'})
ok: [server3] => (item={'key': 'ns2', 'value': 'server3'})
ok: [server3] => (item={'key': 'prometheus', 'value': 'server3'})
ok: [server3] => (item={'key': 'web1', 'value': 'server1'})
ok: [server3] => (item={'key': 'web2', 'value': 'server2'})

TASK [bind_exporter : Bind exporter installed] *********************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [bind_exporter : Copy args] ***********************************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [bind_exporter : Enable bind exporter] ************************************
ok: [server3]
ok: [server1]
ok: [server2]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [prometheus : Prometheus installed] ***************************************
ok: [server3]

TASK [prometheus : CP ARGS] ****************************************************
ok: [server3]

TASK [prometheus : Copy conf] **************************************************
ok: [server3]

TASK [prometheus : Start prometheus] *******************************************
ok: [server3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [grafana : Create the grafana user] ***************************************
ok: [server3]

TASK [grafana : folder with correct permissions datasources] *******************
ok: [server3]

TASK [grafana : folder with correct permissions dashboards] ********************
ok: [server3]

TASK [grafana : Config] ********************************************************
ok: [server3]

TASK [grafana : Datasources] ***************************************************
ok: [server3]

TASK [grafana : dashboards yaml] ***********************************************
ok: [server3]

TASK [grafana : copy dashboards] ***********************************************
ok: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/mysql.json)
ok: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/main.json)
ok: [server3] => (item=/Users/admin/CLionProjects/ica0002/roles/grafana/files/../files/syslog.json)

TASK [grafana : grafana container] *********************************************
ok: [server3]

PLAY [DNS Nameserver conf] *****************************************************

TASK [Gathering Facts] *********************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [dns_resolve : systemdresolved stop] **************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [dns_resolve : CP Dns config] *********************************************
ok: [server2]
ok: [server1]
ok: [server3]

PLAY [MySQL exporter] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [mysql_exporter : Copy config] ********************************************
ok: [server1]
ok: [server2]

TASK [mysql_exporter : Copy prometheus conf] ***********************************
ok: [server2]
ok: [server1]

TASK [mysql_exporter : mysql exporter installed] *******************************
ok: [server2]
ok: [server1]

TASK [mysql_exporter : start mysql exporter] ***********************************
ok: [server1]
ok: [server2]

PLAY [Logging] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [influxdb : ensure influxdb and -client are installed] ********************
ok: [server3]

TASK [influxdb : download telegraf v1.24.2] ************************************
ok: [server3]

TASK [influxdb : install telegraf] *********************************************
ok: [server3]

TASK [influxdb : configure telegraf] *******************************************
ok: [server3]

TASK [influxdb : influxdb started, enabled] ************************************
ok: [server3]

TASK [influxdb : telegraf started, enabled] ************************************
ok: [server3]

TASK [influxdb_backup : influxdb backup directory] *****************************
ok: [server3]

TASK [influxdb_backup : influxdb backup cronjob] *******************************
ok: [server3]

TASK [pinger : ensure fping installed] *****************************************
ok: [server3]

TASK [pinger : Create user pinger] *********************************************
ok: [server3]

TASK [pinger : Pinger config] **************************************************
ok: [server3]

TASK [pinger : Copy pinger conf] ***********************************************
ok: [server3]

TASK [pinger : Copy pinger script] *********************************************
ok: [server3]

TASK [pinger : Copy pinger service] ********************************************
ok: [server3]

TASK [pinger : Start and enable pinger] ****************************************
ok: [server3]

PLAY [Keepalived/HA] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server2]
ok: [server1]

TASK [keepalived : ensure keepalived and netstat installed] ********************
ok: [server2]
ok: [server1]

TASK [keepalived : keepalived script user] *************************************
ok: [server2]
ok: [server1]

TASK [keepalived : Configure keepalived] ***************************************
ok: [server2]
ok: [server1]

TASK [keepalived : download and unzip keepalived exporter] *********************
ok: [server1]
ok: [server2]

TASK [keepalived : keepalived exporter environment] ****************************
ok: [server1]
ok: [server2]

TASK [keepalived : start keepalived] *******************************************
ok: [server1]
ok: [server2]

TASK [keepalived : enable keepalived] ******************************************
ok: [server1]
ok: [server2]

TASK [keepalived : enable keepalived-exporter] *********************************
ok: [server2]
ok: [server1]

TASK [haproxy : Ensure haproxy isnstalled] *************************************
ok: [server2]
ok: [server1]

TASK [haproxy : Haproxy exporter] **********************************************
ok: [server2]
ok: [server1]

TASK [haproxy : cp conf] *******************************************************
ok: [server1]
ok: [server2]

TASK [haproxy : cp conf exporter] **********************************************
ok: [server1]
ok: [server2]

TASK [haproxy : enable haproxy] ************************************************
ok: [server2]
ok: [server1]

TASK [haproxy : enable haproxy exporter] ***************************************
ok: [server2]
ok: [server1]

PLAY [Exporters all] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [nginx_exporter : nginx exporter installed] *******************************
ok: [server2]
ok: [server1]
ok: [server3]

TASK [nginx_exporter : cp template] ********************************************
ok: [server1]
ok: [server2]
ok: [server3]

TASK [nginx_exporter : start and enable nginx exporter] ************************
ok: [server2]
ok: [server1]
ok: [server3]

PLAY [Exporter influxdb] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [server3]

TASK [influxdb_exporter : Download influxstats exporter] ***********************
ok: [server3]

TASK [influxdb_exporter : Env file] ********************************************
ok: [server3]

TASK [influxdb_exporter : CP Service] ******************************************
ok: [server3]

TASK [influxdb_exporter : Enable exporter] *************************************
ok: [server3]

PLAY RECAP *********************************************************************
server1                    : ok=75   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
server2                    : ok=75   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
server3                    : ok=76   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ date
Tue Jan  3 14:07:23 EET 2023
