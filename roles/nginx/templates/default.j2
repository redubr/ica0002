server {
	listen 80 default_server;
	server_name _;

    {% if inventory_hostname in groups['web_servers'] %}
	location / {
		proxy_pass http://localhost:{{agama_nginx}};
	}
	{% endif %}

	{% if inventory_hostname in groups['prometh'] %}
	location /prometheus {
    		proxy_pass http://localhost:{{prom_port}};
    }
	{% endif %}

	{% if inventory_hostname in groups['grafana'] %}
    	location /grafana {
    	        proxy_set_header Host $http_host;
        		proxy_pass http://localhost:{{docker_grafana_port}};
        }
    {% endif %}

}

server {
    listen 8080 default_server;
    location = /stub_status {
        stub_status;
    }
}